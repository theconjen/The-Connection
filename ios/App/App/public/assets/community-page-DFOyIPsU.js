import{r as e,j as s,F as t,_ as a,i as n,k as r,J as i,G as l,u as o,l as c,$ as d}from"./vendor-radix-Cb0-vzxO.js";import{u as m,h as u,q as h,i as x,A as p,d as v,e as f,D as j,o as y,B as g,p as b,r as N,s as w,c as C,m as S,C as P,b as D,f as k,j as _,a as M,I as E,t as T,v as O,n as I}from"./index-CQmKbNyS.js";import{u as L,a as R}from"./vendor-query-qkAKzVJ0.js";import{T as A,a as F,b as $,c as W}from"./tabs-N8_zO4xm.js";import{D as z,b as U,c as B,d as q,e as Y,f as K,a as H}from"./dialog-BfqlROKo.js";import{q as V,a5 as J,Z as Q,a6 as G,a7 as X,a8 as Z,a9 as ee,a4 as se,aa as te,ab as ae,r as ne,ac as re,c as ie,i as le,X as oe,ad as ce,P as de,G as me,U as ue,n as he,M as xe,o as pe,g as ve,ae as fe,T as je,af as ye,C as ge,ag as be,ah as Ne,ai as we,aj as Ce,ak as Se,s as Pe,al as De,am as ke,an as _e,e as Me,ao as Ee,ap as Te,aq as Oe}from"./vendor-icons-CM8Yk8yJ.js";import{L as Ie}from"./label-BZLDYjV_.js";import{S as Le}from"./switch-DyT2ZBYr.js";import{T as Re}from"./textarea-BQP-18ak.js";import{a as Ae,b as Fe,s as $e,e as We,d as ze,g as Ue,h as Be,j as qe,k as Ye,l as Ke,m as He,n as Ve,o as Je,p as Qe,q as Ge,r as Xe,u as Ze,f as es,v as ss,w as ts,x as as,y as ns,z as rs,A as is,B as ls,C as os,D as cs,E as ds,F as ms,G as us,H as hs,I as xs,J as ps}from"./vendor-utils-nlnd1Dju.js";import{u as vs,t as fs,F as js,a as ys,b as gs,c as bs,d as Ns,f as ws,e as Cs}from"./form-Z2c2XcTx.js";import{o as Ss,s as Ps}from"./types-DUVubNlp.js";import{T as Ds,a as ks,b as _s,c as Ms,d as Es,e as Ts}from"./table-Dr1qxf9w.js";import{A as Os,a as Is,b as Ls,c as Rs,d as As,e as Fs,f as $s,g as Ws,h as zs}from"./alert-dialog-CyKD1gnU.js";import{S as Us,a as Bs,b as qs,c as Ys,d as Ks}from"./select-BoJ0bQCi.js";import"./vendor-react-eVk5PToZ.js";function Hs({communityId:t,isOwner:a,isModerator:n}){const{user:r}=m(),{toast:i}=u(),[l,o]=e.useState(!1),[c,d]=e.useState(null),{data:C,isLoading:S,error:P}=L({queryKey:[`/api/communities/${t}/members`],enabled:!!t,queryFn:async()=>{const e=await x("GET",`/api/communities/${t}/members`);return await e.json().catch(()=>[])}}),D=R({mutationFn:async({memberId:e,role:s})=>{const a=await x("PUT",`/api/communities/${t}/members/${e}/role`,{role:s});return await a.json()},onSuccess:()=>{h.invalidateQueries({queryKey:[`/api/communities/${t}/members`]}),i({title:"Role updated",description:"Member's role has been updated successfully"})},onError:e=>{i({title:"Failed to update role",description:e.message,variant:"destructive"})}}),k=R({mutationFn:async e=>{await x("DELETE",`/api/communities/${t}/members/${e}`)},onSuccess:()=>{h.invalidateQueries({queryKey:[`/api/communities/${t}/members`]}),i({title:"Member removed",description:"Member has been removed from the community"}),o(!1)},onError:e=>{i({title:"Failed to remove member",description:e.message,variant:"destructive"})}}),_=(e,s)=>{D.mutate({memberId:e.id,role:s})};if(S)return s.jsxs("div",{className:"flex justify-center items-center p-4",children:[s.jsx(V,{className:"h-6 w-6 animate-spin text-primary"}),s.jsx("span",{className:"ml-2",children:"Loading members..."})]});if(P)return s.jsxs("div",{className:"p-4 text-destructive",children:["Error loading members: ",P.message]});if(!C?.length)return s.jsx("div",{className:"p-4 text-center text-muted-foreground",children:"No members found"});const M=[...C||[]].sort((e,s)=>{const t={owner:0,moderator:1,member:2},a=t[e.role]||3,n=t[s.role]||3;return a!==n?a-n:e.joinedAt&&s.joinedAt?new Date(e.joinedAt).getTime()-new Date(s.joinedAt).getTime():0});return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"font-medium text-lg",children:["Members (",C.length,")"]}),s.jsx("ul",{className:"space-y-2",children:M.map(e=>s.jsxs("li",{className:"flex items-center justify-between p-2 rounded-md hover:bg-muted/50",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs(p,{className:"h-10 w-10",children:[s.jsx(v,{src:e.user.avatarUrl||""}),s.jsx(f,{children:e.user.displayName?.charAt(0)||e.user.username.charAt(0)})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium",children:[e.user.displayName||e.user.username,e.user.id===r?.id&&" (You)"]}),s.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:["@",e.user.username,s.jsx("span",{className:"mx-1",children:"â€¢"}),s.jsx(Vs,{role:e.role})]})]})]}),(a||n&&"member"===e.role)&&e.user.id!==r?.id&&s.jsxs(j,{children:[s.jsx(y,{asChild:!0,children:s.jsx(g,{variant:"ghost",size:"icon",children:s.jsx(J,{className:"h-4 w-4"})})}),s.jsxs(b,{align:"end",children:[a&&s.jsxs(s.Fragment,{children:["moderator"!==e.role&&s.jsxs(N,{onClick:()=>_(e,"moderator"),children:[s.jsx(Q,{className:"mr-2 h-4 w-4"}),s.jsx("span",{children:"Make Moderator"})]}),"moderator"===e.role&&s.jsxs(N,{onClick:()=>_(e,"member"),children:[s.jsx(Q,{className:"mr-2 h-4 w-4"}),s.jsx("span",{children:"Remove Moderator Role"})]}),"owner"!==e.role&&s.jsxs(N,{onClick:()=>_(e,"owner"),children:[s.jsx(G,{className:"mr-2 h-4 w-4"}),s.jsx("span",{children:"Transfer Ownership"})]}),s.jsx(w,{})]}),s.jsxs(N,{className:"text-destructive focus:text-destructive",onClick:()=>(e=>{d(e),o(!0)})(e),children:[s.jsx(X,{className:"mr-2 h-4 w-4"}),s.jsx("span",{children:"Remove from Community"})]})]})]})]},e.id))}),s.jsx(z,{open:l,onOpenChange:o,children:s.jsxs(U,{children:[s.jsxs(B,{children:[s.jsx(q,{children:"Remove Member"}),s.jsxs(Y,{children:["Are you sure you want to remove ",c?.user.displayName||c?.user.username," from this community? This action cannot be undone."]})]}),s.jsxs(K,{className:"gap-2 sm:gap-0",children:[s.jsx(g,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),s.jsx(g,{variant:"destructive",onClick:()=>{c&&k.mutate(c.userId)},disabled:k.isPending,children:k.isPending?s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Removing..."]}):"Remove"})]})]})})]})}function Vs({role:e}){let t;switch(e){case"owner":t=s.jsxs(C,{variant:"default",className:"bg-amber-500 hover:bg-amber-500/90",children:[s.jsx(G,{className:"h-3 w-3 mr-1"}),"Owner"]});break;case"moderator":t=s.jsxs(C,{variant:"default",className:"bg-primary hover:bg-primary/90",children:[s.jsx(Q,{className:"h-3 w-3 mr-1"}),"Moderator"]});break;default:t=s.jsxs(C,{variant:"outline",children:[s.jsx(Z,{className:"h-3 w-3 mr-1"}),"Member"]})}return t}var Js="ScrollArea",[Qs]=n(Js),[Gs,Xs]=Qs(Js),Zs=e.forwardRef((n,i)=>{const{__scopeScrollArea:l,type:o="hover",dir:c,scrollHideDelay:d=600,...m}=n,[u,h]=e.useState(null),[x,p]=e.useState(null),[v,f]=e.useState(null),[j,y]=e.useState(null),[g,b]=e.useState(null),[N,w]=e.useState(0),[C,S]=e.useState(0),[P,D]=e.useState(!1),[k,_]=e.useState(!1),M=t(i,e=>h(e)),E=a(c);return s.jsx(Gs,{scope:l,type:o,dir:E,scrollHideDelay:d,scrollArea:u,viewport:x,onViewportChange:p,content:v,onContentChange:f,scrollbarX:j,onScrollbarXChange:y,scrollbarXEnabled:P,onScrollbarXEnabledChange:D,scrollbarY:g,onScrollbarYChange:b,scrollbarYEnabled:k,onScrollbarYEnabledChange:_,onCornerWidthChange:w,onCornerHeightChange:S,children:s.jsx(r.div,{dir:E,...m,ref:M,style:{position:"relative","--radix-scroll-area-corner-width":N+"px","--radix-scroll-area-corner-height":C+"px",...n.style}})})});Zs.displayName=Js;var et="ScrollAreaViewport",st=e.forwardRef((a,n)=>{const{__scopeScrollArea:i,children:l,nonce:o,...c}=a,d=Xs(et,i),m=e.useRef(null),u=t(n,m,d.onViewportChange);return s.jsxs(s.Fragment,{children:[s.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),s.jsx(r.div,{"data-radix-scroll-area-viewport":"",...c,ref:u,style:{overflowX:d.scrollbarXEnabled?"scroll":"hidden",overflowY:d.scrollbarYEnabled?"scroll":"hidden",...a.style},children:s.jsx("div",{ref:d.onContentChange,style:{minWidth:"100%",display:"table"},children:l})})]})});st.displayName=et;var tt="ScrollAreaScrollbar",at=e.forwardRef((t,a)=>{const{forceMount:n,...r}=t,i=Xs(tt,t.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:o}=i,c="horizontal"===t.orientation;return e.useEffect(()=>(c?l(!0):o(!0),()=>{c?l(!1):o(!1)}),[c,l,o]),"hover"===i.type?s.jsx(nt,{...r,ref:a,forceMount:n}):"scroll"===i.type?s.jsx(rt,{...r,ref:a,forceMount:n}):"auto"===i.type?s.jsx(it,{...r,ref:a,forceMount:n}):"always"===i.type?s.jsx(lt,{...r,ref:a}):null});at.displayName=tt;var nt=e.forwardRef((t,a)=>{const{forceMount:n,...r}=t,l=Xs(tt,t.__scopeScrollArea),[o,c]=e.useState(!1);return e.useEffect(()=>{const e=l.scrollArea;let s=0;if(e){const t=()=>{window.clearTimeout(s),c(!0)},a=()=>{s=window.setTimeout(()=>c(!1),l.scrollHideDelay)};return e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",a),()=>{window.clearTimeout(s),e.removeEventListener("pointerenter",t),e.removeEventListener("pointerleave",a)}}},[l.scrollArea,l.scrollHideDelay]),s.jsx(i,{present:n||o,children:s.jsx(it,{"data-state":o?"visible":"hidden",...r,ref:a})})}),rt=e.forwardRef((t,a)=>{const{forceMount:n,...r}=t,o=Xs(tt,t.__scopeScrollArea),c="horizontal"===t.orientation,d=Pt(()=>u("SCROLL_END"),100),[m,u]=(h="hidden",x={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},e.useReducer((e,s)=>x[e][s]??e,h));var h,x;return e.useEffect(()=>{if("idle"===m){const e=window.setTimeout(()=>u("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(e)}},[m,o.scrollHideDelay,u]),e.useEffect(()=>{const e=o.viewport,s=c?"scrollLeft":"scrollTop";if(e){let t=e[s];const a=()=>{const a=e[s];t!==a&&(u("SCROLL"),d()),t=a};return e.addEventListener("scroll",a),()=>e.removeEventListener("scroll",a)}},[o.viewport,c,u,d]),s.jsx(i,{present:n||"hidden"!==m,children:s.jsx(lt,{"data-state":"hidden"===m?"hidden":"visible",...r,ref:a,onPointerEnter:l(t.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:l(t.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),it=e.forwardRef((t,a)=>{const n=Xs(tt,t.__scopeScrollArea),{forceMount:r,...l}=t,[o,c]=e.useState(!1),d="horizontal"===t.orientation,m=Pt(()=>{if(n.viewport){const e=n.viewport.offsetWidth<n.viewport.scrollWidth,s=n.viewport.offsetHeight<n.viewport.scrollHeight;c(d?e:s)}},10);return Dt(n.viewport,m),Dt(n.content,m),s.jsx(i,{present:r||o,children:s.jsx(lt,{"data-state":o?"visible":"hidden",...l,ref:a})})}),lt=e.forwardRef((t,a)=>{const{orientation:n="vertical",...r}=t,i=Xs(tt,t.__scopeScrollArea),l=e.useRef(null),o=e.useRef(0),[c,d]=e.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),m=gt(c.viewport,c.content),u={...r,sizes:c,onSizesChange:d,hasThumb:Boolean(m>0&&m<1),onThumbChange:e=>l.current=e,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:e=>o.current=e};function h(e,s){return function(e,s,t,a="ltr"){const n=bt(t),r=n/2,i=s||r,l=n-i,o=t.scrollbar.paddingStart+i,c=t.scrollbar.size-t.scrollbar.paddingEnd-l,d=t.content-t.viewport,m="ltr"===a?[0,d]:[-1*d,0];return wt([o,c],m)(e)}(e,o.current,c,s)}return"horizontal"===n?s.jsx(ot,{...u,ref:a,onThumbPositionChange:()=>{if(i.viewport&&l.current){const e=Nt(i.viewport.scrollLeft,c,i.dir);l.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{i.viewport&&(i.viewport.scrollLeft=e)},onDragScroll:e=>{i.viewport&&(i.viewport.scrollLeft=h(e,i.dir))}}):"vertical"===n?s.jsx(ct,{...u,ref:a,onThumbPositionChange:()=>{if(i.viewport&&l.current){const e=Nt(i.viewport.scrollTop,c);l.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{i.viewport&&(i.viewport.scrollTop=e)},onDragScroll:e=>{i.viewport&&(i.viewport.scrollTop=h(e))}}):null}),ot=e.forwardRef((a,n)=>{const{sizes:r,onSizesChange:i,...l}=a,o=Xs(tt,a.__scopeScrollArea),[c,d]=e.useState(),m=e.useRef(null),u=t(n,m,o.onScrollbarXChange);return e.useEffect(()=>{m.current&&d(getComputedStyle(m.current))},[m]),s.jsx(ut,{"data-orientation":"horizontal",...l,ref:u,sizes:r,style:{bottom:0,left:"rtl"===o.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===o.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":bt(r)+"px",...a.style},onThumbPointerDown:e=>a.onThumbPointerDown(e.x),onDragScroll:e=>a.onDragScroll(e.x),onWheelScroll:(e,s)=>{if(o.viewport){const t=o.viewport.scrollLeft+e.deltaX;a.onWheelScroll(t),Ct(t,s)&&e.preventDefault()}},onResize:()=>{m.current&&o.viewport&&c&&i({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:m.current.clientWidth,paddingStart:yt(c.paddingLeft),paddingEnd:yt(c.paddingRight)}})}})}),ct=e.forwardRef((a,n)=>{const{sizes:r,onSizesChange:i,...l}=a,o=Xs(tt,a.__scopeScrollArea),[c,d]=e.useState(),m=e.useRef(null),u=t(n,m,o.onScrollbarYChange);return e.useEffect(()=>{m.current&&d(getComputedStyle(m.current))},[m]),s.jsx(ut,{"data-orientation":"vertical",...l,ref:u,sizes:r,style:{top:0,right:"ltr"===o.dir?0:void 0,left:"rtl"===o.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":bt(r)+"px",...a.style},onThumbPointerDown:e=>a.onThumbPointerDown(e.y),onDragScroll:e=>a.onDragScroll(e.y),onWheelScroll:(e,s)=>{if(o.viewport){const t=o.viewport.scrollTop+e.deltaY;a.onWheelScroll(t),Ct(t,s)&&e.preventDefault()}},onResize:()=>{m.current&&o.viewport&&c&&i({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:m.current.clientHeight,paddingStart:yt(c.paddingTop),paddingEnd:yt(c.paddingBottom)}})}})}),[dt,mt]=Qs(tt),ut=e.forwardRef((a,n)=>{const{__scopeScrollArea:i,sizes:c,hasThumb:d,onThumbChange:m,onThumbPointerUp:u,onThumbPointerDown:h,onThumbPositionChange:x,onDragScroll:p,onWheelScroll:v,onResize:f,...j}=a,y=Xs(tt,i),[g,b]=e.useState(null),N=t(n,e=>b(e)),w=e.useRef(null),C=e.useRef(""),S=y.viewport,P=c.content-c.viewport,D=o(v),k=o(x),_=Pt(f,10);function M(e){if(w.current){const s=e.clientX-w.current.left,t=e.clientY-w.current.top;p({x:s,y:t})}}return e.useEffect(()=>{const e=e=>{const s=e.target,t=g?.contains(s);t&&D(e,P)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[S,g,P,D]),e.useEffect(k,[c,k]),Dt(g,_),Dt(y.content,_),s.jsx(dt,{scope:i,scrollbar:g,hasThumb:d,onThumbChange:o(m),onThumbPointerUp:o(u),onThumbPositionChange:k,onThumbPointerDown:o(h),children:s.jsx(r.div,{...j,ref:N,style:{position:"absolute",...j.style},onPointerDown:l(a.onPointerDown,e=>{if(0===e.button){e.target.setPointerCapture(e.pointerId),w.current=g.getBoundingClientRect(),C.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",y.viewport&&(y.viewport.style.scrollBehavior="auto"),M(e)}}),onPointerMove:l(a.onPointerMove,M),onPointerUp:l(a.onPointerUp,e=>{const s=e.target;s.hasPointerCapture(e.pointerId)&&s.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=C.current,y.viewport&&(y.viewport.style.scrollBehavior=""),w.current=null})})})}),ht="ScrollAreaThumb",xt=e.forwardRef((e,t)=>{const{forceMount:a,...n}=e,r=mt(ht,e.__scopeScrollArea);return s.jsx(i,{present:a||r.hasThumb,children:s.jsx(pt,{ref:t,...n})})}),pt=e.forwardRef((a,n)=>{const{__scopeScrollArea:i,style:o,...c}=a,d=Xs(ht,i),m=mt(ht,i),{onThumbPositionChange:u}=m,h=t(n,e=>m.onThumbChange(e)),x=e.useRef(void 0),p=Pt(()=>{x.current&&(x.current(),x.current=void 0)},100);return e.useEffect(()=>{const e=d.viewport;if(e){const s=()=>{if(p(),!x.current){const s=St(e,u);x.current=s,u()}};return u(),e.addEventListener("scroll",s),()=>e.removeEventListener("scroll",s)}},[d.viewport,p,u]),s.jsx(r.div,{"data-state":m.hasThumb?"visible":"hidden",...c,ref:h,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...o},onPointerDownCapture:l(a.onPointerDownCapture,e=>{const s=e.target.getBoundingClientRect(),t=e.clientX-s.left,a=e.clientY-s.top;m.onThumbPointerDown({x:t,y:a})}),onPointerUp:l(a.onPointerUp,m.onThumbPointerUp)})});xt.displayName=ht;var vt="ScrollAreaCorner",ft=e.forwardRef((e,t)=>{const a=Xs(vt,e.__scopeScrollArea),n=Boolean(a.scrollbarX&&a.scrollbarY);return"scroll"!==a.type&&n?s.jsx(jt,{...e,ref:t}):null});ft.displayName=vt;var jt=e.forwardRef((t,a)=>{const{__scopeScrollArea:n,...i}=t,l=Xs(vt,n),[o,c]=e.useState(0),[d,m]=e.useState(0),u=Boolean(o&&d);return Dt(l.scrollbarX,()=>{const e=l.scrollbarX?.offsetHeight||0;l.onCornerHeightChange(e),m(e)}),Dt(l.scrollbarY,()=>{const e=l.scrollbarY?.offsetWidth||0;l.onCornerWidthChange(e),c(e)}),u?s.jsx(r.div,{...i,ref:a,style:{width:o,height:d,position:"absolute",right:"ltr"===l.dir?0:void 0,left:"rtl"===l.dir?0:void 0,bottom:0,...t.style}}):null});function yt(e){return e?parseInt(e,10):0}function gt(e,s){const t=e/s;return isNaN(t)?0:t}function bt(e){const s=gt(e.viewport,e.content),t=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,a=(e.scrollbar.size-t)*s;return Math.max(a,18)}function Nt(e,s,t="ltr"){const a=bt(s),n=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,r=s.scrollbar.size-n,i=s.content-s.viewport,l=r-a,o=d(e,"ltr"===t?[0,i]:[-1*i,0]);return wt([0,i],[0,l])(o)}function wt(e,s){return t=>{if(e[0]===e[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(e[1]-e[0]);return s[0]+a*(t-e[0])}}function Ct(e,s){return e>0&&e<s}var St=(e,s=()=>{})=>{let t={left:e.scrollLeft,top:e.scrollTop},a=0;return function n(){const r={left:e.scrollLeft,top:e.scrollTop},i=t.left!==r.left,l=t.top!==r.top;(i||l)&&s(),t=r,a=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(a)};function Pt(s,t){const a=o(s),n=e.useRef(0);return e.useEffect(()=>()=>window.clearTimeout(n.current),[]),e.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(a,t)},[a,t])}function Dt(e,s){const t=o(s);c(()=>{let s=0;if(e){const a=new ResizeObserver(()=>{cancelAnimationFrame(s),s=window.requestAnimationFrame(t)});return a.observe(e),()=>{window.cancelAnimationFrame(s),a.unobserve(e)}}},[e,t])}var kt=Zs,_t=st,Mt=ft;const Et=e.forwardRef(({className:e,children:t,...a},n)=>s.jsxs(kt,{ref:n,className:S("relative overflow-hidden",e),...a,children:[s.jsx(_t,{className:"h-full w-full rounded-[inherit]",children:t}),s.jsx(Tt,{}),s.jsx(Mt,{})]}));Et.displayName=kt.displayName;const Tt=e.forwardRef(({className:e,orientation:t="vertical",...a},n)=>s.jsx(at,{ref:n,orientation:t,className:S("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...a,children:s.jsx(xt,{className:"relative flex-1 rounded-full bg-border"})}));function Ot({roomId:t,roomName:a}){const{user:n}=m(),{sendMessage:r,joinRoom:i,leaveRoom:l,sendTyping:o,messages:c,usersTyping:d,isConnected:u,error:h}=function(){const{user:s}=m(),[t,a]=e.useState(null),[n,r]=e.useState(!1),[i,l]=e.useState(!1),[o,c]=e.useState([]),[d,u]=e.useState([]),[h,x]=e.useState(null),p=e.useRef(new Set),v=e.useRef(new Map),f=e.useRef(new Map);e.useEffect(()=>(v.current.set("connected",()=>{r(!0),l(!1),x(null),s&&t?.send(JSON.stringify({type:"auth",userId:s.id,username:s.username,token:"fake-token"}))}),v.current.set("auth_success",e=>{}),v.current.set("room_joined",e=>{}),v.current.set("message_history",e=>{c(s=>{const t=new Set(s.map(e=>e.id)),a=e.messages.filter(e=>!t.has(e.id));return[...s,...a]})}),v.current.set("new_message",e=>{c(s=>[...s,e.message])}),v.current.set("system_message",e=>{const s={id:Date.now(),chatRoomId:e.roomId,senderId:0,content:e.message,createdAt:new Date,isSystemMessage:!0,sender:{id:0,username:"system",displayName:"System",avatarUrl:null}};c(e=>[...e,s])}),v.current.set("user_typing",e=>{u(s=>{const t=[...s.filter(s=>s.userId!==e.userId||s.roomId!==e.roomId),{userId:e.userId,username:e.username,roomId:e.roomId}],a=`${e.userId}-${e.roomId}`,n=f.current.get(a);n&&clearTimeout(n);const r=setTimeout(()=>{u(s=>s.filter(s=>s.userId!==e.userId||s.roomId!==e.roomId)),f.current.delete(a)},3e3);return f.current.set(a,r),t})}),v.current.set("error",e=>{x(e.message)}),v.current.set("pong",()=>{}),()=>{v.current.clear()}),[s,t]),e.useEffect(()=>{if(!t&&!i){l(!0);try{const e=`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}/ws`,s=new WebSocket(e);s.onopen=()=>{a(s)},s.onmessage=e=>{try{const s=JSON.parse(e.data),t=v.current.get(s.type);t&&t(s)}catch(s){}},s.onerror=e=>{x("WebSocket connection error"),l(!1)},s.onclose=()=>{r(!1),a(null),l(!1),p.current.clear(),setTimeout(()=>{l(!1)},5e3)};const t=setInterval(()=>{s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"ping"}))},3e4);return()=>{clearInterval(t),s.close()}}catch(e){x("Failed to connect to chat server"),l(!1)}}},[t,i]);const j=e.useCallback((e,a)=>{t&&t.readyState===WebSocket.OPEN&&s?p.current.has(a)?t.send(JSON.stringify({type:"chat_message",roomId:a,content:e})):x("Cannot send message: Not joined to this room"):x("Cannot send message: Not connected or not authenticated")},[t,s]),y=e.useCallback(e=>{t&&t.readyState===WebSocket.OPEN?(p.current.add(e),t.send(JSON.stringify({type:"join_room",roomId:e}))):x("Cannot join room: Not connected")},[t]),g=e.useCallback(e=>{t&&t.readyState===WebSocket.OPEN&&(p.current.delete(e),t.send(JSON.stringify({type:"leave_room",roomId:e})),c(s=>s.filter(s=>s.chatRoomId!==e)),u(s=>s.filter(s=>s.roomId!==e)))},[t]),b=e.useCallback(e=>{t&&t.readyState===WebSocket.OPEN&&s&&p.current.has(e)&&t.send(JSON.stringify({type:"typing",roomId:e}))},[t,s]);return e.useEffect(()=>()=>{f.current.forEach(e=>clearTimeout(e)),f.current.clear(),t&&t.close()},[t]),{sendMessage:j,joinRoom:y,leaveRoom:g,sendTyping:b,messages:o,usersTyping:d,isConnected:n,isConnecting:i,error:h}}(),[x,p]=e.useState(""),[v,f]=e.useState(!1),j=e.useRef(null),y=c.filter(e=>e.chatRoomId===t),b=d.filter(e=>e.roomId===t&&e.userId!==n?.id);e.useEffect(()=>(i(t),()=>{l(t)}),[t,i,l]),e.useEffect(()=>{j.current?.scrollIntoView({behavior:"smooth"})},[y]);return u?h?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("p",{className:"text-destructive",children:["Error: ",h]})}):s.jsxs("div",{className:"flex flex-col h-[500px] rounded-md border",children:[s.jsx("div",{className:"p-3 border-b bg-muted/20",children:s.jsx("h3",{className:"font-medium",children:a})}),s.jsx(Et,{className:"flex-1 p-4",children:0===y.length?s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("p",{className:"text-muted-foreground",children:"No messages yet. Be the first to say hello!"})}):s.jsxs("div",{className:"space-y-4",children:[y.map(e=>s.jsx(It,{message:e,isOwnMessage:e.senderId===n?.id},e.id)),s.jsx("div",{ref:j})]})}),b.length>0&&s.jsx("div",{className:"px-4 py-1 text-xs text-muted-foreground italic",children:1===b.length?`${b[0].username} is typing...`:`${b.length} people are typing...`}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),x.trim()&&n&&!v){f(!0);try{r(x,t),p("")}catch(s){}finally{f(!1)}}},className:"p-3 border-t flex gap-2",children:[s.jsx(Re,{value:x,onChange:e=>p(e.target.value),onKeyPress:()=>{o(t)},placeholder:"Type your message...",className:"min-h-[60px] resize-none"}),s.jsx(g,{type:"submit",size:"icon",disabled:v,children:v?s.jsx(V,{className:"h-4 w-4 animate-spin"}):s.jsx(ee,{className:"h-4 w-4"})})]})]}):s.jsxs("div",{className:"flex items-center justify-center h-64",children:[s.jsx(V,{className:"w-8 h-8 animate-spin text-primary"}),s.jsx("p",{className:"ml-2",children:"Connecting to chat..."})]})}function It({message:e,isOwnMessage:t}){const a=e.createdAt?Ae(new Date(e.createdAt),{addSuffix:!0}):"";return e.isSystemMessage?s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"inline-block bg-muted/30 rounded-md px-3 py-1 text-xs text-muted-foreground",children:e.content})}):s.jsx("div",{className:"flex "+(t?"justify-end":"justify-start"),children:s.jsxs("div",{className:"flex items-start gap-2 max-w-[80%] "+(t?"flex-row-reverse":""),children:[s.jsxs(p,{className:"h-8 w-8",children:[s.jsx(v,{src:e.sender?.avatarUrl||""}),s.jsx(f,{children:e.sender?.displayName?.charAt(0)||e.sender?.username?.charAt(0)||"?"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("span",{className:"text-sm font-medium",children:e.sender?.displayName||e.sender?.username||"Unknown User"}),s.jsx("span",{className:"text-xs text-muted-foreground",children:a})]}),s.jsx("div",{className:"rounded-lg px-3 py-2 "+(t?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),children:s.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:e.content})})]})]})})}function Lt({communityId:t,isOwner:a,isModerator:n,isMember:r}){m();const{toast:i}=u(),[l,o]=e.useState(!1),[c,d]=e.useState(!1),[p,v]=e.useState(!1),[f,j]=e.useState(null),[y,b]=e.useState(""),[N,w]=e.useState(""),[C,S]=e.useState(!1),{data:T,isLoading:O,error:I}=L({queryKey:[`/api/communities/${t}/chat-rooms`],enabled:!!t}),A=R({mutationFn:async e=>{const s=await x("POST",`/api/communities/${t}/chat-rooms`,e);return await s.json()},onSuccess:e=>{h.invalidateQueries({queryKey:[`/api/communities/${t}/chat-rooms`]}),i({title:"Chat room created",description:`"${e.name}" has been created successfully.`}),o(!1),W()},onError:e=>{i({title:"Failed to create chat room",description:e.message,variant:"destructive"})}}),F=R({mutationFn:async({roomId:e,data:s})=>{const t=await x("PUT",`/api/chat-rooms/${e}`,s);return await t.json()},onSuccess:e=>{h.invalidateQueries({queryKey:[`/api/communities/${t}/chat-rooms`]}),i({title:"Chat room updated",description:`"${e.name}" has been updated successfully.`}),d(!1)},onError:e=>{i({title:"Failed to update chat room",description:e.message,variant:"destructive"})}}),$=R({mutationFn:async e=>{await x("DELETE",`/api/chat-rooms/${e}`)},onSuccess:()=>{h.invalidateQueries({queryKey:[`/api/communities/${t}/chat-rooms`]}),i({title:"Chat room deleted",description:"The chat room has been deleted successfully."}),v(!1),j(null)},onError:e=>{i({title:"Failed to delete chat room",description:e.message,variant:"destructive"})}}),W=()=>{b(""),w(""),S(!1)};if(O)return s.jsxs("div",{className:"flex justify-center items-center p-4",children:[s.jsx(V,{className:"h-6 w-6 animate-spin text-primary"}),s.jsx("span",{className:"ml-2",children:"Loading chat rooms..."})]});if(I)return s.jsxs("div",{className:"p-4 text-destructive",children:["Error loading chat rooms: ",I.message]});const H=Array.isArray(T)?T:[],J=H[0];return r&&0===H.length&&!A.isPending&&(async()=>{r&&0===H.length&&A.mutate({name:"General Chat",description:"Main community discussion",isPrivate:!1})})(),r?s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex justify-between items-center",children:s.jsx("h3",{className:"font-medium text-lg",children:"Community Chat"})}),A.isPending&&s.jsxs("div",{className:"flex justify-center items-center p-4",children:[s.jsx(V,{className:"h-6 w-6 animate-spin text-primary"}),s.jsx("span",{className:"ml-2",children:"Setting up chat room..."})]}),J&&s.jsxs(P,{children:[s.jsxs(D,{className:"pb-2",children:[s.jsx(k,{className:"flex items-center gap-2",children:J.name}),s.jsx(_,{children:J.description||"Community discussion"})]}),s.jsx(M,{children:s.jsx(Ot,{roomId:J.id,roomName:J.name})})]}),!J&&!A.isPending&&s.jsxs("div",{className:"text-center py-6 border rounded-md",children:[s.jsx(te,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),s.jsx("h4",{className:"text-lg font-medium",children:"No Chat Room Yet"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"A chat room will be created automatically for this community."})]}),s.jsx(z,{open:c,onOpenChange:d,children:s.jsxs(U,{children:[s.jsxs(B,{children:[s.jsx(q,{children:"Edit Chat Room"}),s.jsx(Y,{children:"Update the details of this chat room."})]}),s.jsxs("form",{onSubmit:e=>{e.preventDefault(),f&&(y.trim()?F.mutate({roomId:f.id,data:{name:y,description:N,isPrivate:C}}):i({title:"Name required",description:"Please provide a name for the chat room.",variant:"destructive"}))},children:[s.jsxs("div",{className:"grid gap-4 py-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(Ie,{htmlFor:"edit-name",children:"Room Name"}),s.jsx(E,{id:"edit-name",value:y,onChange:e=>b(e.target.value),placeholder:"General Discussion",required:!0})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(Ie,{htmlFor:"edit-description",children:"Description (optional)"}),s.jsx(E,{id:"edit-description",value:N,onChange:e=>w(e.target.value),placeholder:"A place for general community discussions"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Le,{id:"edit-isPrivate",checked:C,onCheckedChange:S}),s.jsx(Ie,{htmlFor:"edit-isPrivate",children:C?s.jsxs("span",{className:"flex items-center",children:[s.jsx(se,{className:"h-4 w-4 mr-1"}),"Private Room (members only)"]}):s.jsxs("span",{className:"flex items-center",children:[s.jsx(ae,{className:"h-4 w-4 mr-1"}),"Public Room (all visitors)"]})})]})]}),s.jsx(K,{children:s.jsx(g,{type:"submit",disabled:F.isPending,children:F.isPending?s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):"Update Room"})})]})]})}),s.jsx(z,{open:p,onOpenChange:v,children:s.jsxs(U,{children:[s.jsxs(B,{children:[s.jsx(q,{children:"Delete Chat Room"}),s.jsxs(Y,{children:['Are you sure you want to delete "',f?.name,'"? This action cannot be undone and all messages will be permanently lost.']})]}),s.jsxs(K,{className:"gap-2 sm:gap-0",children:[s.jsx(g,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),s.jsx(g,{variant:"destructive",onClick:()=>{f&&$.mutate(f.id)},disabled:$.isPending,children:$.isPending?s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete Room"})]})]})})]}):s.jsxs("div",{className:"text-center py-8 border rounded-md",children:[s.jsx(se,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),s.jsx("h4",{className:"text-xl font-medium",children:"Community Chat"}),s.jsx("p",{className:"text-muted-foreground",children:"You need to join this community to access the chat room."})]})}Tt.displayName=at.displayName;const Rt=Ss({email:Ps().min(1,"Email address is required").max(254,"Email address is too long (max 254 characters)").email("Please enter a valid email address").transform(e=>e.trim().toLowerCase()),message:Ps().max(500,"Message is too long (max 500 characters)").optional()});function At({communityId:t,communityName:a,children:n}){const[r,i]=e.useState(!1),{toast:l}=u(),o=vs({resolver:fs(Rt),defaultValues:{email:"",message:""}}),c=R({mutationFn:async e=>{const s=await x("POST",`/api/communities/${t}/invite`,e);return await s.json()},onSuccess:e=>{l({title:"Invitation sent",description:`An invitation to join "${a}" has been sent to ${o.getValues("email")}`}),h.invalidateQueries({queryKey:[`/api/communities/${t}/invitations`]}),o.reset(),i(!1)},onError:e=>{let s="Failed to send invitation",t=e.message;e.message.includes("already a member")?(s="User Already Member",t="This person is already a member of the community."):e.message.includes("invitation has already been sent")?(s="Invitation Already Sent",t="A pending invitation has already been sent to this email address."):e.message.includes("valid email address")&&(s="Invalid Email",t="Please check the email address and try again."),l({title:s,description:t,variant:"destructive"})}});return s.jsxs(z,{open:r,onOpenChange:i,children:[s.jsx(H,{asChild:!0,children:n}),s.jsxs(U,{className:"sm:max-w-[425px]","data-testid":"dialog-invite-user",children:[s.jsxs(B,{children:[s.jsxs(q,{className:"flex items-center gap-2",children:[s.jsx(Z,{className:"h-5 w-5"}),"Invite Member"]}),s.jsxs(Y,{children:['Send an invitation to join "',a,'" to someone via email.']})]}),s.jsx(js,{...o,children:s.jsxs("form",{onSubmit:o.handleSubmit(e=>{c.mutate(e)}),className:"space-y-4",children:[s.jsx(ys,{control:o.control,name:"email",render:({field:e})=>s.jsxs(gs,{children:[s.jsx(bs,{children:"Email Address"}),s.jsx(Ns,{children:s.jsxs("div",{className:"relative",children:[s.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(E,{placeholder:"Enter email address",className:"pl-10","data-testid":"input-email",...e})]})}),s.jsx(ws,{children:"The person will receive an invitation email with a secure link to join the community."}),s.jsx(Cs,{})]})}),s.jsx(ys,{control:o.control,name:"message",render:({field:e})=>s.jsxs(gs,{children:[s.jsx(bs,{children:"Personal Message (Optional)"}),s.jsx(Ns,{children:s.jsx(Re,{placeholder:"Add a personal message to the invitation...",className:"min-h-[80px]","data-testid":"textarea-message",...e})}),s.jsx(ws,{children:"This message will be included in the invitation email."}),s.jsx(Cs,{})]})}),s.jsxs(K,{className:"gap-2",children:[s.jsx(g,{type:"button",variant:"outline",onClick:()=>i(!1),"data-testid":"button-cancel",children:"Cancel"}),s.jsxs(g,{type:"submit",disabled:c.isPending,"data-testid":"button-send-invite",children:[c.isPending&&s.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Send Invitation"]})]})]})})]})]})}function Ft({communityId:t,communityName:a}){const{toast:n}=u(),[r,i]=e.useState(null),{data:l,isLoading:o,error:c}=L({queryKey:[`/api/communities/${t}/invitations`],enabled:!!t}),d=R({mutationFn:async e=>{i(e);const s=await x("DELETE",`/api/invitations/${e}`);return await s.json()},onSuccess:()=>{n({title:"Invitation cancelled",description:"The invitation has been successfully cancelled."}),h.invalidateQueries({queryKey:[`/api/communities/${t}/invitations`]})},onError:e=>{n({title:"Failed to cancel invitation",description:e.message,variant:"destructive"})},onSettled:()=>{i(null)}}),m=e=>e?new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e)):"N/A",p=e=>{switch(e){case"pending":default:return"default";case"accepted":return"secondary";case"declined":return"destructive";case"expired":return"outline"}};if(o)return s.jsxs(P,{"data-testid":"card-invitation-manager",children:[s.jsxs(D,{children:[s.jsxs(k,{className:"flex items-center gap-2",children:[s.jsx(Z,{className:"h-5 w-5"}),"Pending Invitations"]}),s.jsxs(_,{children:['Manage invitations to join "',a,'"']})]}),s.jsx(M,{children:s.jsxs("div",{className:"flex justify-center items-center py-8",children:[s.jsx(V,{className:"h-6 w-6 animate-spin"}),s.jsx("span",{className:"ml-2",children:"Loading invitations..."})]})})]});if(c)return s.jsxs(P,{"data-testid":"card-invitation-manager",children:[s.jsxs(D,{children:[s.jsxs(k,{className:"flex items-center gap-2",children:[s.jsx(Z,{className:"h-5 w-5"}),"Pending Invitations"]}),s.jsxs(_,{children:['Manage invitations to join "',a,'"']})]}),s.jsx(M,{children:s.jsxs("div",{className:"text-center py-8",children:[s.jsx(re,{className:"h-8 w-8 text-destructive mx-auto mb-2"}),s.jsx("p",{className:"text-muted-foreground",children:"Failed to load invitations"})]})})]});const v=l?.filter(e=>"pending"===e.status)||[],f=l||[];return s.jsxs(P,{"data-testid":"card-invitation-manager",children:[s.jsxs(D,{children:[s.jsxs(k,{className:"flex items-center gap-2",children:[s.jsx(Z,{className:"h-5 w-5"}),"Pending Invitations"]}),s.jsxs(_,{children:['Manage invitations to join "',a,'"']})]}),s.jsxs(M,{children:[0===v.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(ne,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),s.jsx("p",{className:"text-muted-foreground",children:"No pending invitations"}),s.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:'Use the "Invite Member" option to send invitations to new members.'})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:s.jsxs("span",{children:[v.length," pending invitation",1!==v.length?"s":""]})}),s.jsx("div",{className:"rounded-md border",children:s.jsxs(Ds,{children:[s.jsx(ks,{children:s.jsxs(_s,{children:[s.jsx(Ms,{children:"Email"}),s.jsx(Ms,{children:"Status"}),s.jsx(Ms,{children:"Sent"}),s.jsx(Ms,{children:"Expires"}),s.jsx(Ms,{className:"w-[100px]",children:"Actions"})]})}),s.jsx(Es,{children:v.map(e=>{const t=(a=e.expiresAt,new Date(a)<new Date);var a;return s.jsxs(_s,{"data-testid":`row-invitation-${e.id}`,children:[s.jsx(Ts,{className:"font-medium",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.inviteeEmail]})}),s.jsx(Ts,{children:s.jsx(C,{variant:t?"destructive":p(e.status),children:t?"Expired":e.status})}),s.jsx(Ts,{children:s.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[s.jsx(ie,{className:"h-3 w-3"}),m(e.createdAt)]})}),s.jsx(Ts,{children:s.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[s.jsx(le,{className:"h-3 w-3"}),m(e.expiresAt)]})}),s.jsx(Ts,{children:s.jsxs(Os,{children:[s.jsx(Is,{asChild:!0,children:s.jsx(g,{variant:"ghost",size:"sm",disabled:d.isPending&&r===e.id,"data-testid":`button-cancel-${e.id}`,children:d.isPending&&r===e.id?s.jsx(V,{className:"h-4 w-4 animate-spin"}):s.jsx(oe,{className:"h-4 w-4"})})}),s.jsxs(Ls,{"data-testid":`dialog-cancel-${e.id}`,children:[s.jsxs(Rs,{children:[s.jsx(As,{children:"Cancel Invitation"}),s.jsxs(Fs,{children:["Are you sure you want to cancel the invitation for ",e.inviteeEmail,"? This action cannot be undone and they will not be able to use the existing invitation link."]})]}),s.jsxs($s,{children:[s.jsx(Ws,{"data-testid":"button-cancel-dialog-cancel",children:"Cancel"}),s.jsx(zs,{onClick:()=>d.mutate(e.id),"data-testid":"button-cancel-dialog-confirm",children:"Cancel Invitation"})]})]})]})})]},e.id)})})]})})]}),f.length>v.length&&s.jsx("div",{className:"mt-6 pt-4 border-t",children:s.jsxs("p",{className:"text-sm text-muted-foreground",children:[f.length-v.length," invitation",f.length-v.length!==1?"s":""," completed (accepted/declined/expired)"]})})]})]})}function $t({community:t,isMember:a,isOwner:n,isModerator:r}){const{user:i}=m(),{toast:l}=u(),[o,c]=e.useState("all"),[d,j]=e.useState(!1),[y,b]=e.useState(""),[N,w]=e.useState(!1),[S,k]=e.useState(new Set),{data:_=[],isLoading:E,error:T,refetch:O}=L({queryKey:[`/api/communities/${t.id}/wall`,o],queryFn:async()=>{const e=new URLSearchParams({filter:o});return(await x("GET",`/api/communities/${t.id}/wall?${e}`)).json()},enabled:Boolean(t&&(a||!t.hasPrivateWall&&t.hasPublicWall))}),I=R({mutationFn:async e=>(await x("POST",`/api/communities/${t.id}/wall`,{content:e.content,isPrivate:e.isPrivate})).json(),onSuccess:()=>{h.invalidateQueries({queryKey:[`/api/communities/${t.id}/wall`]}),b(""),j(!1),l({title:"Post created",description:"Your post has been shared with the community."})},onError:e=>{l({title:"Failed to create post",description:e.message,variant:"destructive"})}}),A=R({mutationFn:async e=>{await x("POST",`/api/wall-posts/${e}/like`,{})},onSuccess:()=>{h.invalidateQueries({queryKey:[`/api/communities/${t.id}/wall`]})}}),F=R({mutationFn:async e=>{await x("DELETE",`/api/wall-posts/${e}/like`)},onSuccess:()=>{h.invalidateQueries({queryKey:[`/api/communities/${t.id}/wall`]})}}),$=e=>Fe(new Date(e),new Date,{addSuffix:!0});return!a&&t.hasPrivateWall?s.jsxs("div",{className:"text-center py-16",children:[s.jsx("div",{className:"mx-auto mb-6 p-4 rounded-full bg-amber-50 dark:bg-amber-900/20 w-fit",children:s.jsx(se,{className:"h-12 w-12 text-amber-600 dark:text-amber-500"})}),s.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Private Feed"}),s.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:"This community has a private wall. Join the community to see posts and participate in discussions."})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Community Feed"}),s.jsx("p",{className:"text-muted-foreground",children:"Latest posts and discussions"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(Us,{value:o,onValueChange:e=>c(e),children:[s.jsxs(Bs,{className:"w-32",children:[s.jsx(ce,{className:"h-4 w-4 mr-2"}),s.jsx(qs,{})]}),s.jsxs(Ys,{children:[s.jsx(Ks,{value:"all",children:"All Posts"}),s.jsx(Ks,{value:"recent",children:"Recent"}),s.jsx(Ks,{value:"popular",children:"Popular"}),a&&s.jsxs(s.Fragment,{children:[s.jsx(Ks,{value:"public",children:"Public Only"}),s.jsx(Ks,{value:"private",children:"Private Only"})]})]})]}),a&&s.jsxs(z,{open:d,onOpenChange:j,children:[s.jsx(H,{asChild:!0,children:s.jsxs(g,{"data-testid":"button-create-post",children:[s.jsx(de,{className:"h-4 w-4 mr-2"}),"New Post"]})}),s.jsxs(U,{className:"max-w-2xl",children:[s.jsxs(B,{children:[s.jsx(q,{children:"Create a Post"}),s.jsxs(Y,{children:["Share something with the ",t.name," community"]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(Re,{placeholder:"What's on your mind?",value:y,onChange:e=>b(e.target.value),className:"min-h-32 resize-none","data-testid":"textarea-post-content"}),t.hasPrivateWall&&t.hasPublicWall&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm font-medium",children:"Post Visibility:"}),s.jsxs(Us,{value:N?"private":"public",onValueChange:e=>w("private"===e),children:[s.jsx(Bs,{className:"w-32",children:s.jsx(qs,{})}),s.jsxs(Ys,{children:[s.jsx(Ks,{value:"public",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(me,{className:"h-4 w-4 mr-2"}),"Public"]})}),s.jsx(Ks,{value:"private",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(se,{className:"h-4 w-4 mr-2"}),"Members Only"]})})]})]})]})]}),s.jsxs(K,{children:[s.jsx(g,{variant:"outline",onClick:()=>j(!1),disabled:I.isPending,children:"Cancel"}),s.jsx(g,{onClick:()=>{y.trim()&&I.mutate({content:y,isPrivate:N})},disabled:!y.trim()||I.isPending,"data-testid":"button-submit-post",children:I.isPending?s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"h-4 w-4 mr-2 animate-spin"}),"Posting..."]}):s.jsxs(s.Fragment,{children:[s.jsx(ee,{className:"h-4 w-4 mr-2"}),"Post"]})})]})]})]})]})]}),E&&s.jsx("div",{className:"space-y-4",children:[1,2,3].map(e=>s.jsxs(P,{className:"animate-pulse",children:[s.jsx(D,{children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-muted rounded-full"}),s.jsxs("div",{className:"space-y-2 flex-1",children:[s.jsx("div",{className:"h-4 bg-muted rounded w-24"}),s.jsx("div",{className:"h-3 bg-muted rounded w-16"})]})]})}),s.jsx(M,{children:s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"h-4 bg-muted rounded w-full"}),s.jsx("div",{className:"h-4 bg-muted rounded w-3/4"})]})})]},e))}),T&&s.jsx(P,{className:"border-destructive/50 bg-destructive/10",children:s.jsx(M,{className:"pt-6",children:s.jsx("p",{className:"text-destructive text-center",children:"Failed to load posts. Please try again."})})}),!E&&!T&&s.jsx("div",{className:"space-y-6",children:0===_.length?s.jsx(P,{children:s.jsxs(M,{className:"pt-6 text-center py-12",children:[s.jsx(ue,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts yet"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"Be the first to share something with the community!"}),a&&s.jsxs(g,{onClick:()=>j(!0),"data-testid":"button-first-post",children:[s.jsx(de,{className:"h-4 w-4 mr-2"}),"Create First Post"]})]})}):_.map(e=>s.jsxs(P,{className:"overflow-hidden","data-testid":`post-${e.id}`,children:[s.jsx(D,{className:"pb-4",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs(p,{className:"w-10 h-10",children:[s.jsx(v,{src:e.author.avatarUrl}),s.jsx(f,{children:e.author.displayName?.[0]||e.author.username[0].toUpperCase()})]}),s.jsxs("div",{children:[s.jsx("div",{className:"font-semibold",children:e.author.displayName||e.author.username}),s.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[s.jsx(le,{className:"h-3 w-3"}),$(e.createdAt?.toString()||(new Date).toISOString())]})]})]}),e.isPrivate&&s.jsxs(C,{variant:"secondary",className:"flex items-center gap-1",children:[s.jsx(se,{className:"h-3 w-3"}),"Private"]})]})}),s.jsx(M,{className:"pt-0",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.content}),e.imageUrl&&s.jsx("div",{className:"rounded-lg overflow-hidden",children:s.jsx("img",{src:e.imageUrl,alt:"Post image",className:"w-full h-auto max-h-96 object-cover"})}),s.jsx("div",{className:"flex items-center justify-between pt-2 border-t",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs(g,{variant:"ghost",size:"sm",className:e.isLiked?"text-red-500":"",onClick:()=>(e=>{e.isLiked?F.mutate(e.id):A.mutate(e.id)})(e),"data-testid":`button-like-post-${e.id}`,children:[s.jsx(he,{className:"h-4 w-4 mr-1 "+(e.isLiked?"fill-current":"")}),e.likeCount]}),s.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>(e=>{const s=new Set(S);s.has(e)?s.delete(e):s.add(e),k(s)})(e.id),"data-testid":`button-comments-${e.id}`,children:[s.jsx(xe,{className:"h-4 w-4 mr-1"}),e.commentCount]}),s.jsxs(g,{variant:"ghost",size:"sm","data-testid":`button-share-${e.id}`,children:[s.jsx(pe,{className:"h-4 w-4 mr-1"}),"Share"]})]})}),S.has(e.id)&&s.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[a&&s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsxs(p,{className:"w-8 h-8",children:[s.jsx(v,{src:i?.avatarUrl||void 0}),s.jsx(f,{children:i?.displayName?.[0]||i?.username?.[0]?.toUpperCase()})]}),s.jsxs("div",{className:"flex-1 flex items-center space-x-2",children:[s.jsx(Re,{placeholder:"Write a comment...",className:"min-h-8 resize-none",rows:1}),s.jsx(g,{size:"sm",children:s.jsx(ee,{className:"h-3 w-3"})})]})]}),e.comments?.map(e=>s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsxs(p,{className:"w-8 h-8",children:[s.jsx(v,{src:e.author.avatarUrl||void 0}),s.jsx(f,{children:e.author.displayName?.[0]||e.author.username[0]?.toUpperCase()})]}),s.jsxs("div",{className:"flex-1 bg-muted p-3 rounded-lg",children:[s.jsx("div",{className:"font-semibold text-sm",children:e.author.displayName||e.author.username}),s.jsx("div",{className:"text-sm",children:e.content}),s.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:$(e.createdAt)})]})]},e.id))]})]})})]},e.id))})]})}const Wt=[{id:"general",name:"General Discussion",description:"Open discussions about anything",icon:"ðŸ’¬"},{id:"questions",name:"Questions & Help",description:"Ask questions and get help",icon:"â“"},{id:"announcements",name:"Announcements",description:"Community announcements",icon:"ðŸ“¢"},{id:"prayer",name:"Prayer Requests",description:"Share and pray together",icon:"ðŸ™"},{id:"bible-study",name:"Bible Study",description:"Scripture discussion and study",icon:"ðŸ“–"},{id:"fellowship",name:"Fellowship",description:"Connect and build relationships",icon:"ðŸ¤"}];function zt({community:t,isMember:a,isOwner:n,isModerator:r}){const{user:i}=m(),{toast:l}=u(),[o,c]=e.useState("all"),[d,j]=e.useState("newest"),[y,b]=e.useState("all"),[N,w]=e.useState(""),[S,k]=e.useState(!1),[_,T]=e.useState(""),[O,I]=e.useState(""),[A,F]=e.useState("general"),[$,W]=e.useState(new Set),[J,Q]=e.useState({}),{data:G=[],isLoading:X,error:Z,refetch:te}=L({queryKey:["/api/microblogs",t.id,o,d,y],queryFn:async()=>{const e=new URLSearchParams({communityId:t.id.toString(),filter:o,sort:d,category:y,type:"forum"});return(await x("GET",`/api/microblogs?${e}`)).json()},enabled:a||!t.isPrivate}),ae=R({mutationFn:async e=>(await x("POST","/api/microblogs",{content:`**${e.title}**\n\n${e.content}`,communityId:t.id,metadata:{category:e.category,isForumTopic:!0}})).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/microblogs",t.id]}),T(""),I(""),F("general"),k(!1),l({title:"Topic created",description:"Your discussion topic has been created."})},onError:e=>{l({title:"Failed to create topic",description:e.message,variant:"destructive"})}}),ne=R({mutationFn:async e=>(await x("POST","/api/microblogs",{content:e.content,communityId:t.id,parentId:e.parentId})).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/microblogs",t.id]}),Q({}),l({title:"Reply added",description:"Your reply has been added to the discussion."})},onError:e=>{l({title:"Failed to add reply",description:e.message,variant:"destructive"})}}),re=R({mutationFn:async e=>{await x("POST",`/api/microblogs/${e}/like`,{})},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/microblogs",t.id]})}}),ie=e=>{const s=e.match(/^\*\*(.*?)\*\*/);return s?s[1]:e.substring(0,100)},oe=e=>Fe(new Date(e),new Date,{addSuffix:!0});return!a&&t.isPrivate?s.jsxs("div",{className:"text-center py-16",children:[s.jsx("div",{className:"mx-auto mb-6 p-4 rounded-full bg-amber-50 dark:bg-amber-900/20 w-fit",children:s.jsx(se,{className:"h-12 w-12 text-amber-600 dark:text-amber-500"})}),s.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Private Forum"}),s.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:"This community's forum is private. Join the community to participate in discussions."})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Community Forum"}),s.jsx("p",{className:"text-muted-foreground",children:"Join the discussion"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(E,{placeholder:"Search discussions...",className:"pl-10 w-64",value:N,onChange:e=>w(e.target.value)})]}),a&&s.jsxs(z,{open:S,onOpenChange:k,children:[s.jsx(H,{asChild:!0,children:s.jsxs(g,{"data-testid":"button-create-topic",children:[s.jsx(de,{className:"h-4 w-4 mr-2"}),"New Topic"]})}),s.jsxs(U,{className:"max-w-2xl",children:[s.jsxs(B,{children:[s.jsx(q,{children:"Start a New Discussion"}),s.jsxs(Y,{children:["Create a new topic for the ",t.name," community"]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Category"}),s.jsxs(Us,{value:A,onValueChange:F,children:[s.jsx(Bs,{children:s.jsx(qs,{})}),s.jsx(Ys,{children:Wt.map(e=>s.jsx(Ks,{value:e.id,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"mr-2",children:e.icon}),e.name]})},e.id))})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Topic Title"}),s.jsx(E,{placeholder:"What's your topic about?",value:_,onChange:e=>T(e.target.value),"data-testid":"input-topic-title"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Description"}),s.jsx(Re,{placeholder:"Provide more details about your topic...",value:O,onChange:e=>I(e.target.value),className:"min-h-32 resize-none","data-testid":"textarea-topic-content"})]})]}),s.jsxs(K,{children:[s.jsx(g,{variant:"outline",onClick:()=>k(!1),disabled:ae.isPending,children:"Cancel"}),s.jsx(g,{onClick:()=>{_.trim()&&O.trim()&&ae.mutate({title:_,content:O,category:A})},disabled:!_.trim()||!O.trim()||ae.isPending,"data-testid":"button-submit-topic",children:ae.isPending?s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):s.jsxs(s.Fragment,{children:[s.jsx(ee,{className:"h-4 w-4 mr-2"}),"Create Topic"]})})]})]})]})]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[s.jsxs(Us,{value:y,onValueChange:b,children:[s.jsx(Bs,{className:"w-48",children:s.jsx(qs,{placeholder:"All Categories"})}),s.jsxs(Ys,{children:[s.jsx(Ks,{value:"all",children:"All Categories"}),Wt.map(e=>s.jsx(Ks,{value:e.id,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"mr-2",children:e.icon}),e.name]})},e.id))]})]}),s.jsxs(Us,{value:d,onValueChange:e=>j(e),children:[s.jsx(Bs,{className:"w-32",children:s.jsx(qs,{})}),s.jsxs(Ys,{children:[s.jsx(Ks,{value:"newest",children:"Newest"}),s.jsx(Ks,{value:"popular",children:"Popular"}),s.jsx(Ks,{value:"activity",children:"Recent Activity"}),s.jsx(Ks,{value:"oldest",children:"Oldest"})]})]}),s.jsxs(Us,{value:o,onValueChange:e=>c(e),children:[s.jsxs(Bs,{className:"w-36",children:[s.jsx(ce,{className:"h-4 w-4 mr-2"}),s.jsx(qs,{})]}),s.jsxs(Ys,{children:[s.jsx(Ks,{value:"all",children:"All Topics"}),s.jsx(Ks,{value:"recent",children:"Recent"}),s.jsx(Ks,{value:"popular",children:"Popular"}),s.jsx(Ks,{value:"answered",children:"Answered"}),s.jsx(Ks,{value:"unanswered",children:"Unanswered"})]})]})]}),X&&s.jsx("div",{className:"space-y-4",children:[1,2,3,4].map(e=>s.jsxs(P,{className:"animate-pulse",children:[s.jsx(D,{children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-muted rounded-full"}),s.jsxs("div",{className:"space-y-2 flex-1",children:[s.jsx("div",{className:"h-4 bg-muted rounded w-48"}),s.jsx("div",{className:"h-3 bg-muted rounded w-32"})]})]})}),s.jsx(M,{children:s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"h-4 bg-muted rounded w-full"}),s.jsx("div",{className:"h-4 bg-muted rounded w-2/3"})]})})]},e))}),!X&&!Z&&s.jsx("div",{className:"space-y-4",children:0===G.length?s.jsx(P,{children:s.jsxs(M,{className:"pt-6 text-center py-12",children:[s.jsx(fe,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No discussions yet"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"Start the first discussion in this community!"}),a&&s.jsxs(g,{onClick:()=>k(!0),"data-testid":"button-first-topic",children:[s.jsx(de,{className:"h-4 w-4 mr-2"}),"Start Discussion"]})]})}):G.map(e=>{return s.jsxs(P,{className:"overflow-hidden","data-testid":`topic-${e.id}`,children:[s.jsx(D,{className:"pb-4",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(C,{variant:"secondary",className:"text-xs",children:"ðŸ’¬ General"}),e.replyCount>10&&s.jsxs(C,{variant:"outline",className:"text-xs",children:[s.jsx(je,{className:"h-3 w-3 mr-1"}),"Popular"]})]}),s.jsx("h3",{className:"font-semibold text-lg leading-tight mb-2",children:ie(e.content)}),s.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs(p,{className:"w-6 h-6",children:[s.jsx(v,{src:e.author.avatarUrl}),s.jsx(f,{className:"text-xs",children:e.author.displayName?.[0]||e.author.username[0].toUpperCase()})]}),s.jsx("span",{children:e.author.displayName||e.author.username})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(le,{className:"h-3 w-3 mr-1"}),oe(e.createdAt.toString())]})]})]}),s.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center justify-end space-x-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(xe,{className:"h-4 w-4 mr-1"}),s.jsx("span",{children:e.replyCount})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(he,{className:"h-4 w-4 mr-1"}),s.jsx("span",{children:e.likeCount})]})]}),e.recentReply&&s.jsxs("div",{className:"text-xs mt-1",children:["Last reply by ",e.recentReply.author]})]})]})}),s.jsx(M,{className:"pt-0",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:(t=e.content,t.replace(/^\*\*(.*?)\*\*\n\n/,""))}),s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs(g,{variant:"ghost",size:"sm",className:e.isLiked?"text-red-500":"",onClick:()=>re.mutate(e.id),children:[s.jsx(he,{className:"h-4 w-4 mr-1 "+(e.isLiked?"fill-current":"")}),e.likeCount]}),s.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>(e=>{const s=new Set($);s.has(e)?s.delete(e):s.add(e),W(s)})(e.id),"data-testid":`button-expand-topic-${e.id}`,children:[s.jsx(xe,{className:"h-4 w-4 mr-1"}),$.has(e.id)?"Hide":"View"," Replies (",e.replyCount,")"]})]})}),$.has(e.id)&&s.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[a&&s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsxs(p,{className:"w-8 h-8",children:[s.jsx(v,{src:i?.avatarUrl||void 0}),s.jsx(f,{className:"text-xs",children:i?.displayName?.[0]||i?.username?.[0]?.toUpperCase()})]}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx(Re,{placeholder:"Add your thoughts...",className:"min-h-20 resize-none",value:J[e.id]||"",onChange:s=>((e,s)=>{Q(t=>({...t,[e]:s}))})(e.id,s.target.value),"data-testid":`textarea-reply-${e.id}`}),s.jsx("div",{className:"flex justify-end",children:s.jsxs(g,{size:"sm",onClick:()=>(e=>{const s=J[e]?.trim();s&&ne.mutate({parentId:e,content:s})})(e.id),disabled:!J[e.id]?.trim()||ne.isPending,"data-testid":`button-submit-reply-${e.id}`,children:[ne.isPending?s.jsx(V,{className:"h-3 w-3 mr-1 animate-spin"}):s.jsx(ye,{className:"h-3 w-3 mr-1"}),"Reply"]})})]})]}),e.replies?.map(e=>s.jsxs("div",{className:"flex items-start space-x-3 pl-6 border-l-2 border-muted",children:[s.jsxs(p,{className:"w-8 h-8",children:[s.jsx(v,{src:e.author.avatarUrl}),s.jsx(f,{className:"text-xs",children:e.author.displayName?.[0]||e.author.username[0].toUpperCase()})]}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:"font-semibold text-sm",children:e.author.displayName||e.author.username}),s.jsx("span",{className:"text-xs text-muted-foreground",children:oe(e.createdAt.toString())})]}),s.jsx("p",{className:"text-sm",children:e.content})]}),s.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[s.jsxs(g,{variant:"ghost",size:"sm",className:"text-xs h-6",children:[s.jsx(he,{className:"h-3 w-3 mr-1"}),e.likeCount]}),s.jsxs(g,{variant:"ghost",size:"sm",className:"text-xs h-6",children:[s.jsx(ye,{className:"h-3 w-3 mr-1"}),"Reply"]})]})]})]},e.id))]})]})})]},e.id);var t})})]})}var Ut=function(){return Ut=Object.assign||function(e){for(var s,t=1,a=arguments.length;t<a;t++)for(var n in s=arguments[t])Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);return e},Ut.apply(this,arguments)};function Bt(e,s,t){for(var a,n=0,r=s.length;n<r;n++)!a&&n in s||(a||(a=Array.prototype.slice.call(s,0,n)),a[n]=s[n]);return e.concat(a||Array.prototype.slice.call(s))}function qt(e){return"multiple"===e.mode}function Yt(e){return"range"===e.mode}function Kt(e){return"single"===e.mode}"function"==typeof SuppressedError&&SuppressedError;var Ht={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};var Vt=Object.freeze({__proto__:null,formatCaption:function(e,s){return es(e,"LLLL y",s)},formatDay:function(e,s){return es(e,"d",s)},formatMonthCaption:function(e,s){return es(e,"LLLL",s)},formatWeekNumber:function(e){return"".concat(e)},formatWeekdayName:function(e,s){return es(e,"cccccc",s)},formatYearCaption:function(e,s){return es(e,"yyyy",s)}}),Jt=Object.freeze({__proto__:null,labelDay:function(e,s,t){return es(e,"do MMMM (EEEE)",t)},labelMonthDropdown:function(){return"Month: "},labelNext:function(){return"Go to next month"},labelPrevious:function(){return"Go to previous month"},labelWeekNumber:function(e){return"Week n. ".concat(e)},labelWeekday:function(e,s){return es(e,"cccc",s)},labelYearDropdown:function(){return"Year: "}});var Qt=e.createContext(void 0);function Gt(e){var t,a,n=e.initialProps,r={captionLayout:"buttons",classNames:Ht,formatters:Vt,labels:Jt,locale:Ue,modifiersClassNames:{},modifiers:{},numberOfMonths:1,styles:{},today:new Date,mode:"default"},i=function(e){var s=e.fromYear,t=e.toYear,a=e.fromMonth,n=e.toMonth,r=e.fromDate,i=e.toDate;return a?r=$e(a):s&&(r=new Date(s,0,1)),n?i=We(n):t&&(i=new Date(t,11,31)),{fromDate:r?ze(r):void 0,toDate:i?ze(i):void 0}}(n),l=i.fromDate,o=i.toDate,c=null!==(t=n.captionLayout)&&void 0!==t?t:r.captionLayout;"buttons"===c||l&&o||(c="buttons"),(Kt(n)||qt(n)||Yt(n))&&(a=n.onSelect);var d=Ut(Ut(Ut({},r),n),{captionLayout:c,classNames:Ut(Ut({},r.classNames),n.classNames),components:Ut({},n.components),formatters:Ut(Ut({},r.formatters),n.formatters),fromDate:l,labels:Ut(Ut({},r.labels),n.labels),mode:n.mode||r.mode,modifiers:Ut(Ut({},r.modifiers),n.modifiers),modifiersClassNames:Ut(Ut({},r.modifiersClassNames),n.modifiersClassNames),onSelect:a,styles:Ut(Ut({},r.styles),n.styles),toDate:o});return s.jsx(Qt.Provider,{value:d,children:e.children})}function Xt(){var s=e.useContext(Qt);if(!s)throw new Error("useDayPicker must be used within a DayPickerProvider.");return s}function Zt(e){var t=Xt(),a=t.locale,n=t.classNames,r=t.styles,i=t.formatters.formatCaption;return s.jsx("div",{className:n.caption_label,style:r.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:i(e.displayMonth,{locale:a})})}function ea(e){return s.jsx("svg",Ut({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:s.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function sa(e){var t,a,n=e.onChange,r=e.value,i=e.children,l=e.caption,o=e.className,c=e.style,d=Xt(),m=null!==(a=null===(t=d.components)||void 0===t?void 0:t.IconDropdown)&&void 0!==a?a:ea;return s.jsxs("div",{className:o,style:c,children:[s.jsx("span",{className:d.classNames.vhidden,children:e["aria-label"]}),s.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:d.classNames.dropdown,style:d.styles.dropdown,value:r,onChange:n,children:i}),s.jsxs("div",{className:d.classNames.caption_label,style:d.styles.caption_label,"aria-hidden":"true",children:[l,s.jsx(m,{className:d.classNames.dropdown_icon,style:d.styles.dropdown_icon})]})]})}function ta(e){var t,a=Xt(),n=a.fromDate,r=a.toDate,i=a.styles,l=a.locale,o=a.formatters.formatMonthCaption,c=a.classNames,d=a.components,m=a.labels.labelMonthDropdown;if(!n)return s.jsx(s.Fragment,{});if(!r)return s.jsx(s.Fragment,{});var u=[];if(rs(n,r))for(var h=$e(n),x=n.getMonth();x<=r.getMonth();x++)u.push(is(h,x));else for(h=$e(new Date),x=0;x<=11;x++)u.push(is(h,x));var p=null!==(t=null==d?void 0:d.Dropdown)&&void 0!==t?t:sa;return s.jsx(p,{name:"months","aria-label":m(),className:c.dropdown_month,style:i.dropdown_month,onChange:function(s){var t=Number(s.target.value),a=is($e(e.displayMonth),t);e.onChange(a)},value:e.displayMonth.getMonth(),caption:o(e.displayMonth,{locale:l}),children:u.map(function(e){return s.jsx("option",{value:e.getMonth(),children:o(e,{locale:l})},e.getMonth())})})}function aa(e){var t,a=e.displayMonth,n=Xt(),r=n.fromDate,i=n.toDate,l=n.locale,o=n.styles,c=n.classNames,d=n.components,m=n.formatters.formatYearCaption,u=n.labels.labelYearDropdown,h=[];if(!r)return s.jsx(s.Fragment,{});if(!i)return s.jsx(s.Fragment,{});for(var x=r.getFullYear(),p=i.getFullYear(),v=x;v<=p;v++)h.push(ls(os(new Date),v));var f=null!==(t=null==d?void 0:d.Dropdown)&&void 0!==t?t:sa;return s.jsx(f,{name:"years","aria-label":u(),className:c.dropdown_year,style:o.dropdown_year,onChange:function(s){var t=ls($e(a),Number(s.target.value));e.onChange(t)},value:a.getFullYear(),caption:m(a,{locale:l}),children:h.map(function(e){return s.jsx("option",{value:e.getFullYear(),children:m(e,{locale:l})},e.getFullYear())})})}function na(){var s=Xt(),t=function(e){var s=e.month,t=e.defaultMonth,a=e.today,n=s||t||a||new Date,r=e.toDate,i=e.fromDate,l=e.numberOfMonths,o=void 0===l?1:l;return r&&qe(r,n)<0&&(n=Be(r,-1*(o-1))),i&&qe(n,i)<0&&(n=i),$e(n)}(s),a=function(s,t){var a=e.useState(s),n=a[0];return[void 0===t?n:t,a[1]]}(t,s.month),n=a[0],r=a[1];return[n,function(e){var t;if(!s.disableNavigation){var a=$e(e);r(a),null===(t=s.onMonthChange)||void 0===t||t.call(s,a)}}]}var ra=e.createContext(void 0);function ia(e){var t=Xt(),a=na(),n=a[0],r=a[1],i=function(e,s){for(var t=s.reverseMonths,a=s.numberOfMonths,n=$e(e),r=$e(Be(n,a)),i=qe(r,n),l=[],o=0;o<i;o++){var c=Be(n,o);l.push(c)}return t&&(l=l.reverse()),l}(n,t),l=function(e,s){if(!s.disableNavigation){var t=s.toDate,a=s.pagedNavigation,n=s.numberOfMonths,r=void 0===n?1:n,i=a?r:1,l=$e(e);if(!t)return Be(l,i);if(!(qe(t,e)<r))return Be(l,i)}}(n,t),o=function(e,s){if(!s.disableNavigation){var t=s.fromDate,a=s.pagedNavigation,n=s.numberOfMonths,r=a?void 0===n?1:n:1,i=$e(e);if(!t)return Be(i,-r);if(!(qe(i,t)<=0))return Be(i,-r)}}(n,t),c=function(e){return i.some(function(s){return Ye(e,s)})},d={currentMonth:n,displayMonths:i,goToMonth:r,goToDate:function(e,s){c(e)||(s&&Ke(e,s)?r(Be(e,1+-1*t.numberOfMonths)):r(e))},previousMonth:o,nextMonth:l,isDateDisplayed:c};return s.jsx(ra.Provider,{value:d,children:e.children})}function la(){var s=e.useContext(ra);if(!s)throw new Error("useNavigation must be used within a NavigationProvider");return s}function oa(e){var t,a=Xt(),n=a.classNames,r=a.styles,i=a.components,l=la().goToMonth,o=function(s){l(Be(s,e.displayIndex?-e.displayIndex:0))},c=null!==(t=null==i?void 0:i.CaptionLabel)&&void 0!==t?t:Zt,d=s.jsx(c,{id:e.id,displayMonth:e.displayMonth});return s.jsxs("div",{className:n.caption_dropdowns,style:r.caption_dropdowns,children:[s.jsx("div",{className:n.vhidden,children:d}),s.jsx(ta,{onChange:o,displayMonth:e.displayMonth}),s.jsx(aa,{onChange:o,displayMonth:e.displayMonth})]})}function ca(e){return s.jsx("svg",Ut({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:s.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function da(e){return s.jsx("svg",Ut({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:s.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var ma=e.forwardRef(function(e,t){var a=Xt(),n=a.classNames,r=a.styles,i=[n.button_reset,n.button];e.className&&i.push(e.className);var l=i.join(" "),o=Ut(Ut({},r.button_reset),r.button);return e.style&&Object.assign(o,e.style),s.jsx("button",Ut({},e,{ref:t,type:"button",className:l,style:o}))});function ua(e){var t,a,n=Xt(),r=n.dir,i=n.locale,l=n.classNames,o=n.styles,c=n.labels,d=c.labelPrevious,m=c.labelNext,u=n.components;if(!e.nextMonth&&!e.previousMonth)return s.jsx(s.Fragment,{});var h=d(e.previousMonth,{locale:i}),x=[l.nav_button,l.nav_button_previous].join(" "),p=m(e.nextMonth,{locale:i}),v=[l.nav_button,l.nav_button_next].join(" "),f=null!==(t=null==u?void 0:u.IconRight)&&void 0!==t?t:da,j=null!==(a=null==u?void 0:u.IconLeft)&&void 0!==a?a:ca;return s.jsxs("div",{className:l.nav,style:o.nav,children:[!e.hidePrevious&&s.jsx(ma,{name:"previous-month","aria-label":h,className:x,style:o.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:"rtl"===r?s.jsx(f,{className:l.nav_icon,style:o.nav_icon}):s.jsx(j,{className:l.nav_icon,style:o.nav_icon})}),!e.hideNext&&s.jsx(ma,{name:"next-month","aria-label":p,className:v,style:o.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:"rtl"===r?s.jsx(j,{className:l.nav_icon,style:o.nav_icon}):s.jsx(f,{className:l.nav_icon,style:o.nav_icon})})]})}function ha(e){var t=Xt().numberOfMonths,a=la(),n=a.previousMonth,r=a.nextMonth,i=a.goToMonth,l=a.displayMonths,o=l.findIndex(function(s){return Ye(e.displayMonth,s)}),c=0===o,d=o===l.length-1,m=t>1&&(c||!d),u=t>1&&(d||!c);return s.jsx(ua,{displayMonth:e.displayMonth,hideNext:m,hidePrevious:u,nextMonth:r,previousMonth:n,onPreviousClick:function(){n&&i(n)},onNextClick:function(){r&&i(r)}})}function xa(e){var t,a,n=Xt(),r=n.classNames,i=n.disableNavigation,l=n.styles,o=n.captionLayout,c=n.components,d=null!==(t=null==c?void 0:c.CaptionLabel)&&void 0!==t?t:Zt;return a=i?s.jsx(d,{id:e.id,displayMonth:e.displayMonth}):"dropdown"===o?s.jsx(oa,{displayMonth:e.displayMonth,id:e.id}):"dropdown-buttons"===o?s.jsxs(s.Fragment,{children:[s.jsx(oa,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),s.jsx(ha,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):s.jsxs(s.Fragment,{children:[s.jsx(d,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),s.jsx(ha,{displayMonth:e.displayMonth,id:e.id})]}),s.jsx("div",{className:r.caption,style:l.caption,children:a})}function pa(e){var t=Xt(),a=t.footer,n=t.styles,r=t.classNames.tfoot;return a?s.jsx("tfoot",{className:r,style:n.tfoot,children:s.jsx("tr",{children:s.jsx("td",{colSpan:8,children:a})})}):s.jsx(s.Fragment,{})}function va(){var e=Xt(),t=e.classNames,a=e.styles,n=e.showWeekNumber,r=e.locale,i=e.weekStartsOn,l=e.ISOWeek,o=e.formatters.formatWeekdayName,c=e.labels.labelWeekday,d=function(e,s,t){for(var a=t?ms(new Date):us(new Date,{locale:e,weekStartsOn:s}),n=[],r=0;r<7;r++){var i=Ve(a,r);n.push(i)}return n}(r,i,l);return s.jsxs("tr",{style:a.head_row,className:t.head_row,children:[n&&s.jsx("td",{style:a.head_cell,className:t.head_cell}),d.map(function(e,n){return s.jsx("th",{scope:"col",className:t.head_cell,style:a.head_cell,"aria-label":c(e,{locale:r}),children:o(e,{locale:r})},n)})]})}function fa(){var e,t=Xt(),a=t.classNames,n=t.styles,r=t.components,i=null!==(e=null==r?void 0:r.HeadRow)&&void 0!==e?e:va;return s.jsx("thead",{style:n.head,className:a.head,children:s.jsx(i,{})})}function ja(e){var t=Xt(),a=t.locale,n=t.formatters.formatDay;return s.jsx(s.Fragment,{children:n(e.date,{locale:a})})}var ya=e.createContext(void 0);function ga(e){if(!qt(e.initialProps)){return s.jsx(ya.Provider,{value:{selected:void 0,modifiers:{disabled:[]}},children:e.children})}return s.jsx(ba,{initialProps:e.initialProps,children:e.children})}function ba(e){var t=e.initialProps,a=e.children,n=t.selected,r=t.min,i=t.max,l={disabled:[]};n&&l.disabled.push(function(e){var s=i&&n.length>i-1,t=n.some(function(s){return He(s,e)});return Boolean(s&&!t)});var o={selected:n,onDayClick:function(e,s,a){var l,o;if((null===(l=t.onDayClick)||void 0===l||l.call(t,e,s,a),!Boolean(s.selected&&r&&(null==n?void 0:n.length)===r))&&!Boolean(!s.selected&&i&&(null==n?void 0:n.length)===i)){var c=n?Bt([],n):[];if(s.selected){var d=c.findIndex(function(s){return He(e,s)});c.splice(d,1)}else c.push(e);null===(o=t.onSelect)||void 0===o||o.call(t,c,e,s,a)}},modifiers:l};return s.jsx(ya.Provider,{value:o,children:a})}function Na(){var s=e.useContext(ya);if(!s)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return s}var wa,Ca,Sa=e.createContext(void 0);function Pa(e){if(!Yt(e.initialProps)){return s.jsx(Sa.Provider,{value:{selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}},children:e.children})}return s.jsx(Da,{initialProps:e.initialProps,children:e.children})}function Da(e){var t=e.initialProps,a=e.children,n=t.selected,r=n||{},i=r.from,l=r.to,o=t.min,c=t.max,d={range_start:[],range_end:[],range_middle:[],disabled:[]};if(i?(d.range_start=[i],l?(d.range_end=[l],He(i,l)||(d.range_middle=[{after:i,before:l}])):d.range_end=[i]):l&&(d.range_start=[l],d.range_end=[l]),o&&(i&&!l&&d.disabled.push({after:Je(i,o-1),before:Ve(i,o-1)}),i&&l&&d.disabled.push({after:i,before:Ve(i,o-1)}),!i&&l&&d.disabled.push({after:Je(l,o-1),before:Ve(l,o-1)})),c){if(i&&!l&&(d.disabled.push({before:Ve(i,1-c)}),d.disabled.push({after:Ve(i,c-1)})),i&&l){var m=c-(Qe(l,i)+1);d.disabled.push({before:Je(i,m)}),d.disabled.push({after:Ve(l,m)})}!i&&l&&(d.disabled.push({before:Ve(l,1-c)}),d.disabled.push({after:Ve(l,c-1)}))}return s.jsx(Sa.Provider,{value:{selected:n,onDayClick:function(e,s,a){var r,i;null===(r=t.onDayClick)||void 0===r||r.call(t,e,s,a);var l=function(e,s){var t=s||{},a=t.from,n=t.to;if(a&&n){if(He(n,e)&&He(a,e))return;if(He(n,e))return{from:n,to:void 0};if(He(a,e))return;return ss(a,e)?{from:e,to:n}:{from:a,to:e}}return n?ss(e,n)?{from:n,to:e}:{from:e,to:n}:a?Ke(e,a)?{from:e,to:a}:{from:a,to:e}:{from:e,to:void 0}}(e,n);null===(i=t.onSelect)||void 0===i||i.call(t,l,e,s,a)},modifiers:d},children:a})}function ka(){var s=e.useContext(Sa);if(!s)throw new Error("useSelectRange must be used within a SelectRangeProvider");return s}function _a(e){return Array.isArray(e)?Bt([],e):void 0!==e?[e]:[]}(Ca=wa||(wa={})).Outside="outside",Ca.Disabled="disabled",Ca.Selected="selected",Ca.Hidden="hidden",Ca.Today="today",Ca.RangeStart="range_start",Ca.RangeEnd="range_end",Ca.RangeMiddle="range_middle";var Ma=wa.Selected,Ea=wa.Disabled,Ta=wa.Hidden,Oa=wa.Today,Ia=wa.RangeEnd,La=wa.RangeMiddle,Ra=wa.RangeStart,Aa=wa.Outside;var Fa=e.createContext(void 0);function $a(e){var t=Xt(),a=function(e,s,t){var a,n=((a={})[Ma]=_a(e.selected),a[Ea]=_a(e.disabled),a[Ta]=_a(e.hidden),a[Oa]=[e.today],a[Ia]=[],a[La]=[],a[Ra]=[],a[Aa]=[],a);return e.fromDate&&n[Ea].push({before:e.fromDate}),e.toDate&&n[Ea].push({after:e.toDate}),qt(e)?n[Ea]=n[Ea].concat(s.modifiers[Ea]):Yt(e)&&(n[Ea]=n[Ea].concat(t.modifiers[Ea]),n[Ra]=t.modifiers[Ra],n[La]=t.modifiers[La],n[Ia]=t.modifiers[Ia]),n}(t,Na(),ka()),n=function(e){var s={};return Object.entries(e).forEach(function(e){var t=e[0],a=e[1];s[t]=_a(a)}),s}(t.modifiers),r=Ut(Ut({},a),n);return s.jsx(Fa.Provider,{value:r,children:e.children})}function Wa(){var s=e.useContext(Fa);if(!s)throw new Error("useModifiers must be used within a ModifiersProvider");return s}function za(e,s){return s.some(function(s){if("boolean"==typeof s)return s;if(ps(s))return He(e,s);var t,a,n,r,i;if(function(e){return Array.isArray(e)&&e.every(ps)}(s))return s.includes(e);if(function(e){return Boolean(e&&"object"==typeof e&&"from"in e)}(s))return t=e,r=(a=s).from,i=a.to,r&&i?(Qe(i,r)<0&&(r=(n=[i,r])[0],i=n[1]),Qe(t,r)>=0&&Qe(i,t)>=0):i?He(i,t):!!r&&He(r,t);if(function(e){return Boolean(e&&"object"==typeof e&&"dayOfWeek"in e)}(s))return s.dayOfWeek.includes(e.getDay());if(function(e){return Boolean(e&&"object"==typeof e&&"before"in e&&"after"in e)}(s)){var l=Qe(s.before,e)>0,o=Qe(s.after,e)<0;return ss(s.before,s.after)?o&&l:l||o}return function(e){return Boolean(e&&"object"==typeof e&&"after"in e)}(s)?Qe(e,s.after)>0:function(e){return Boolean(e&&"object"==typeof e&&"before"in e)}(s)?Qe(s.before,e)>0:"function"==typeof s&&s(e)})}function Ua(e,s,t){var a=Object.keys(s).reduce(function(t,a){var n=s[a];return za(e,n)&&t.push(a),t},[]),n={};return a.forEach(function(e){return n[e]=!0}),t&&!Ye(e,t)&&(n.outside=!0),n}function Ba(e,s){var t=s.moveBy,a=s.direction,n=s.context,r=s.modifiers,i=s.retry,l=void 0===i?{count:0,lastFocused:e}:i,o=n.weekStartsOn,c=n.fromDate,d=n.toDate,m=n.locale,u={day:Ve,week:Xe,month:Be,year:ts,startOfWeek:function(e){return n.ISOWeek?ms(e):us(e,{locale:m,weekStartsOn:o})},endOfWeek:function(e){return n.ISOWeek?cs(e):ds(e,{locale:m,weekStartsOn:o})}}[t](e,"after"===a?1:-1);"before"===a&&c?u=as([c,u]):"after"===a&&d&&(u=ns([d,u]));var h=!0;if(r){var x=Ua(u,r);h=!x.disabled&&!x.hidden}return h?u:l.count>365?l.lastFocused:Ba(u,{moveBy:t,direction:a,context:n,modifiers:r,retry:Ut(Ut({},l),{count:l.count+1})})}var qa=e.createContext(void 0);function Ya(t){var a=la(),n=Wa(),r=e.useState(),i=r[0],l=r[1],o=e.useState(),c=o[0],d=o[1],m=function(e,s){for(var t,a,n=$e(e[0]),r=We(e[e.length-1]),i=n;i<=r;){var l=Ua(i,s);if(l.disabled||l.hidden)i=Ve(i,1);else{if(l.selected)return i;l.today&&!a&&(a=i),t||(t=i),i=Ve(i,1)}}return a||t}(a.displayMonths,n),u=(null!=i?i:c&&a.isDateDisplayed(c))?c:m,h=function(e){l(e)},x=Xt(),p=function(e,s){if(i){var t=Ba(i,{moveBy:e,direction:s,context:x,modifiers:n});He(i,t)||(a.goToDate(t,i),h(t))}},v={focusedDay:i,focusTarget:u,blur:function(){d(i),l(void 0)},focus:h,focusDayAfter:function(){return p("day","after")},focusDayBefore:function(){return p("day","before")},focusWeekAfter:function(){return p("week","after")},focusWeekBefore:function(){return p("week","before")},focusMonthBefore:function(){return p("month","before")},focusMonthAfter:function(){return p("month","after")},focusYearBefore:function(){return p("year","before")},focusYearAfter:function(){return p("year","after")},focusStartOfWeek:function(){return p("startOfWeek","before")},focusEndOfWeek:function(){return p("endOfWeek","after")}};return s.jsx(qa.Provider,{value:v,children:t.children})}function Ka(){var s=e.useContext(qa);if(!s)throw new Error("useFocusContext must be used within a FocusProvider");return s}var Ha=e.createContext(void 0);function Va(e){if(!Kt(e.initialProps)){return s.jsx(Ha.Provider,{value:{selected:void 0},children:e.children})}return s.jsx(Ja,{initialProps:e.initialProps,children:e.children})}function Ja(e){var t=e.initialProps,a=e.children,n={selected:t.selected,onDayClick:function(e,s,a){var n,r,i;null===(n=t.onDayClick)||void 0===n||n.call(t,e,s,a),!s.selected||t.required?null===(i=t.onSelect)||void 0===i||i.call(t,e,e,s,a):null===(r=t.onSelect)||void 0===r||r.call(t,void 0,e,s,a)}};return s.jsx(Ha.Provider,{value:n,children:a})}function Qa(){var s=e.useContext(Ha);if(!s)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return s}function Ga(e,s){var t=[e.classNames.day];return Object.keys(s).forEach(function(s){var a=e.modifiersClassNames[s];if(a)t.push(a);else if(function(e){return Object.values(wa).includes(e)}(s)){var n=e.classNames["day_".concat(s)];n&&t.push(n)}}),t}function Xa(t,a,n){var r,i,l,o=Xt(),c=Ka(),d=function(e,s){return Ua(e,Wa(),s)}(t,a),m=function(e,s){var t=Xt(),a=Qa(),n=Na(),r=ka(),i=Ka(),l=i.focusDayAfter,o=i.focusDayBefore,c=i.focusWeekAfter,d=i.focusWeekBefore,m=i.blur,u=i.focus,h=i.focusMonthBefore,x=i.focusMonthAfter,p=i.focusYearBefore,v=i.focusYearAfter,f=i.focusStartOfWeek,j=i.focusEndOfWeek;return{onClick:function(i){var l,o,c,d;Kt(t)?null===(l=a.onDayClick)||void 0===l||l.call(a,e,s,i):qt(t)?null===(o=n.onDayClick)||void 0===o||o.call(n,e,s,i):Yt(t)?null===(c=r.onDayClick)||void 0===c||c.call(r,e,s,i):null===(d=t.onDayClick)||void 0===d||d.call(t,e,s,i)},onFocus:function(a){var n;u(e),null===(n=t.onDayFocus)||void 0===n||n.call(t,e,s,a)},onBlur:function(a){var n;m(),null===(n=t.onDayBlur)||void 0===n||n.call(t,e,s,a)},onKeyDown:function(a){var n;switch(a.key){case"ArrowLeft":a.preventDefault(),a.stopPropagation(),"rtl"===t.dir?l():o();break;case"ArrowRight":a.preventDefault(),a.stopPropagation(),"rtl"===t.dir?o():l();break;case"ArrowDown":a.preventDefault(),a.stopPropagation(),c();break;case"ArrowUp":a.preventDefault(),a.stopPropagation(),d();break;case"PageUp":a.preventDefault(),a.stopPropagation(),a.shiftKey?p():h();break;case"PageDown":a.preventDefault(),a.stopPropagation(),a.shiftKey?v():x();break;case"Home":a.preventDefault(),a.stopPropagation(),f();break;case"End":a.preventDefault(),a.stopPropagation(),j()}null===(n=t.onDayKeyDown)||void 0===n||n.call(t,e,s,a)},onKeyUp:function(a){var n;null===(n=t.onDayKeyUp)||void 0===n||n.call(t,e,s,a)},onMouseEnter:function(a){var n;null===(n=t.onDayMouseEnter)||void 0===n||n.call(t,e,s,a)},onMouseLeave:function(a){var n;null===(n=t.onDayMouseLeave)||void 0===n||n.call(t,e,s,a)},onPointerEnter:function(a){var n;null===(n=t.onDayPointerEnter)||void 0===n||n.call(t,e,s,a)},onPointerLeave:function(a){var n;null===(n=t.onDayPointerLeave)||void 0===n||n.call(t,e,s,a)},onTouchCancel:function(a){var n;null===(n=t.onDayTouchCancel)||void 0===n||n.call(t,e,s,a)},onTouchEnd:function(a){var n;null===(n=t.onDayTouchEnd)||void 0===n||n.call(t,e,s,a)},onTouchMove:function(a){var n;null===(n=t.onDayTouchMove)||void 0===n||n.call(t,e,s,a)},onTouchStart:function(a){var n;null===(n=t.onDayTouchStart)||void 0===n||n.call(t,e,s,a)}}}(t,d),u=function(){var e=Xt(),s=Qa(),t=Na(),a=ka();return Kt(e)?s.selected:qt(e)?t.selected:Yt(e)?a.selected:void 0}(),h=Boolean(o.onDayClick||"default"!==o.mode);e.useEffect(function(){var e;d.outside||c.focusedDay&&h&&He(c.focusedDay,t)&&(null===(e=n.current)||void 0===e||e.focus())},[c.focusedDay,t,n,h,d.outside]);var x=Ga(o,d).join(" "),p=function(e,s){var t=Ut({},e.styles.day);return Object.keys(s).forEach(function(s){var a;t=Ut(Ut({},t),null===(a=e.modifiersStyles)||void 0===a?void 0:a[s])}),t}(o,d),v=Boolean(d.outside&&!o.showOutsideDays||d.hidden),f=null!==(l=null===(i=o.components)||void 0===i?void 0:i.DayContent)&&void 0!==l?l:ja,j={style:p,className:x,children:s.jsx(f,{date:t,displayMonth:a,activeModifiers:d}),role:"gridcell"},y=c.focusTarget&&He(c.focusTarget,t)&&!d.outside,g=c.focusedDay&&He(c.focusedDay,t),b=Ut(Ut(Ut({},j),((r={disabled:d.disabled,role:"gridcell"})["aria-selected"]=d.selected,r.tabIndex=g||y?0:-1,r)),m);return{isButton:h,isHidden:v,activeModifiers:d,selectedDays:u,buttonProps:b,divProps:j}}function Za(t){var a=e.useRef(null),n=Xa(t.date,t.displayMonth,a);return n.isHidden?s.jsx("div",{role:"gridcell"}):n.isButton?s.jsx(ma,Ut({name:"day",ref:a},n.buttonProps)):s.jsx("div",Ut({},n.divProps))}function en(e){var t=e.number,a=e.dates,n=Xt(),r=n.onWeekNumberClick,i=n.styles,l=n.classNames,o=n.locale,c=n.labels.labelWeekNumber,d=(0,n.formatters.formatWeekNumber)(Number(t),{locale:o});if(!r)return s.jsx("span",{className:l.weeknumber,style:i.weeknumber,children:d});var m=c(Number(t),{locale:o});return s.jsx(ma,{name:"week-number","aria-label":m,className:l.weeknumber,style:i.weeknumber,onClick:function(e){r(t,a,e)},children:d})}function sn(e){var t,a,n,r=Xt(),i=r.styles,l=r.classNames,o=r.showWeekNumber,c=r.components,d=null!==(t=null==c?void 0:c.Day)&&void 0!==t?t:Za,m=null!==(a=null==c?void 0:c.WeekNumber)&&void 0!==a?a:en;return o&&(n=s.jsx("td",{className:l.cell,style:i.cell,children:s.jsx(m,{number:e.weekNumber,dates:e.dates})})),s.jsxs("tr",{className:l.row,style:i.row,children:[n,e.dates.map(function(t){return s.jsx("td",{className:l.cell,style:i.cell,role:"presentation",children:s.jsx(d,{displayMonth:e.displayMonth,date:t})},Ze(t))})]})}function tn(e,s,t){for(var a=(null==t?void 0:t.ISOWeek)?cs(s):ds(s,t),n=(null==t?void 0:t.ISOWeek)?ms(e):us(e,t),r=Qe(a,n),i=[],l=0;l<=r;l++)i.push(Ve(n,l));return i.reduce(function(e,s){var a=(null==t?void 0:t.ISOWeek)?hs(s):xs(s,t),n=e.find(function(e){return e.weekNumber===a});return n?(n.dates.push(s),e):(e.push({weekNumber:a,dates:[s]}),e)},[])}function an(e){var t,a,n,r=Xt(),i=r.locale,l=r.classNames,o=r.styles,c=r.hideHead,d=r.fixedWeeks,m=r.components,u=r.weekStartsOn,h=r.firstWeekContainsDate,x=r.ISOWeek,p=function(e,s){var t=tn($e(e),We(e),s);if(null==s?void 0:s.useFixedWeeks){var a=Ge(e,s);if(a<6){var n=t[t.length-1],r=n.dates[n.dates.length-1],i=Xe(r,6-a),l=tn(Xe(r,1),i,s);t.push.apply(t,l)}}return t}(e.displayMonth,{useFixedWeeks:Boolean(d),ISOWeek:x,locale:i,weekStartsOn:u,firstWeekContainsDate:h}),v=null!==(t=null==m?void 0:m.Head)&&void 0!==t?t:fa,f=null!==(a=null==m?void 0:m.Row)&&void 0!==a?a:sn,j=null!==(n=null==m?void 0:m.Footer)&&void 0!==n?n:pa;return s.jsxs("table",{id:e.id,className:l.table,style:o.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!c&&s.jsx(v,{}),s.jsx("tbody",{className:l.tbody,style:o.tbody,children:p.map(function(t){return s.jsx(f,{displayMonth:e.displayMonth,dates:t.dates,weekNumber:t.weekNumber},t.weekNumber)})}),s.jsx(j,{displayMonth:e.displayMonth})]})}var nn="undefined"!=typeof window&&window.document&&window.document.createElement?e.useLayoutEffect:e.useEffect,rn=!1,ln=0;function on(){return"react-day-picker-".concat(++ln)}function cn(t){var a,n,r=Xt(),i=r.dir,l=r.classNames,o=r.styles,c=r.components,d=la().displayMonths,m=function(s){var t,a=null!=s?s:rn?on():null,n=e.useState(a),r=n[0],i=n[1];return nn(function(){null===r&&i(on())},[]),e.useEffect(function(){!1===rn&&(rn=!0)},[]),null!==(t=null!=s?s:r)&&void 0!==t?t:void 0}(r.id?"".concat(r.id,"-").concat(t.displayIndex):void 0),u=r.id?"".concat(r.id,"-grid-").concat(t.displayIndex):void 0,h=[l.month],x=o.month,p=0===t.displayIndex,v=t.displayIndex===d.length-1,f=!p&&!v;"rtl"===i&&(v=(a=[p,v])[0],p=a[1]),p&&(h.push(l.caption_start),x=Ut(Ut({},x),o.caption_start)),v&&(h.push(l.caption_end),x=Ut(Ut({},x),o.caption_end)),f&&(h.push(l.caption_between),x=Ut(Ut({},x),o.caption_between));var j=null!==(n=null==c?void 0:c.Caption)&&void 0!==n?n:xa;return s.jsxs("div",{className:h.join(" "),style:x,children:[s.jsx(j,{id:m,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),s.jsx(an,{id:u,"aria-labelledby":m,displayMonth:t.displayMonth})]},t.displayIndex)}function dn(e){var t=Xt(),a=t.classNames,n=t.styles;return s.jsx("div",{className:a.months,style:n.months,children:e.children})}function mn(t){var a,n,r=t.initialProps,i=Xt(),l=Ka(),o=la(),c=e.useState(!1),d=c[0],m=c[1];e.useEffect(function(){i.initialFocus&&l.focusTarget&&(d||(l.focus(l.focusTarget),m(!0)))},[i.initialFocus,d,l.focus,l.focusTarget,l]);var u=[i.classNames.root,i.className];i.numberOfMonths>1&&u.push(i.classNames.multiple_months),i.showWeekNumber&&u.push(i.classNames.with_weeknumber);var h=Ut(Ut({},i.styles.root),i.style),x=Object.keys(r).filter(function(e){return e.startsWith("data-")}).reduce(function(e,s){var t;return Ut(Ut({},e),((t={})[s]=r[s],t))},{}),p=null!==(n=null===(a=r.components)||void 0===a?void 0:a.Months)&&void 0!==n?n:dn;return s.jsx("div",Ut({className:u.join(" "),style:h,dir:i.dir,id:i.id,nonce:r.nonce,title:r.title,lang:r.lang},x,{children:s.jsx(p,{children:o.displayMonths.map(function(e,t){return s.jsx(cn,{displayIndex:t,displayMonth:e},t)})})}))}function un(e){var t=e.children,a=function(e,s){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(t[a[n]]=e[a[n]])}return t}(e,["children"]);return s.jsx(Gt,{initialProps:a,children:s.jsx(ia,{children:s.jsx(Va,{initialProps:a,children:s.jsx(ga,{initialProps:a,children:s.jsx(Pa,{initialProps:a,children:s.jsx($a,{children:s.jsx(Ya,{children:t})})})})})})})}function hn(e){return s.jsx(un,Ut({},e,{children:s.jsx(mn,{initialProps:e})}))}function xn({className:e,classNames:t,showOutsideDays:a=!0,...n}){return s.jsx(hn,{showOutsideDays:a,className:S("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:S(T({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:S(T({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({className:e,...t})=>s.jsx(be,{className:S("h-4 w-4",e),...t}),IconRight:({className:e,...t})=>s.jsx(ge,{className:S("h-4 w-4",e),...t})},...n})}xn.displayName="Calendar";const pn=(e,s)=>{const t=es(new Date(e),"h:mm a");if(s){return`${t} - ${es(new Date(s),"h:mm a")}`}return t},vn=e=>es(new Date(e),"MMM d, yyyy 'at' h:mm a");function fn({community:t,isMember:a,isOwner:n,isModerator:r}){const{user:i}=m(),{toast:l}=u(),[o,c]=e.useState("grid"),[d,p]=e.useState("upcoming"),[v,f]=e.useState(new Date),[j,y]=e.useState(!1),[b,N]=e.useState({title:"",description:"",startDate:"",startTime:"",endDate:"",endTime:"",location:"",isOnline:!1,maxAttendees:"",tags:""}),{data:w=[],isLoading:C,error:S,refetch:k}=L({queryKey:["/api/events",t.id,d],queryFn:async()=>(await x("GET",`/api/events?communityId=${t.id}&filter=${d}`)).json(),enabled:a||!t.isPrivate}),_=R({mutationFn:async e=>(await x("POST","/api/events",{...e,communityId:t.id,createdBy:i?.id})).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/events",t.id]}),N({title:"",description:"",startDate:"",startTime:"",endDate:"",endTime:"",location:"",isOnline:!1,maxAttendees:"",tags:""}),y(!1),l({title:"Event created",description:"Your event has been created successfully."})},onError:e=>{l({title:"Failed to create event",description:e.message,variant:"destructive"})}}),T=R({mutationFn:async({eventId:e,status:s})=>(await x("PATCH",`/api/events/${e}/rsvp`,{status:s})).json(),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/events",t.id]}),l({title:"RSVP updated",description:"Your attendance status has been updated."})},onError:e=>{l({title:"Failed to update RSVP",description:e.message,variant:"destructive"})}}),O=(e,s)=>{T.mutate({eventId:e,status:s})},I=e=>w.filter(s=>He(new Date(s.startDateTime),e));return!a&&t.isPrivate?s.jsxs("div",{className:"text-center py-16",children:[s.jsx("div",{className:"mx-auto mb-6 p-4 rounded-full bg-amber-50 dark:bg-amber-900/20 w-fit",children:s.jsx(Ne,{className:"h-12 w-12 text-amber-600 dark:text-amber-500"})}),s.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Private Events"}),s.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:"This community's events are private. Join the community to see and attend events."})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Community Events"}),s.jsx("p",{className:"text-muted-foreground",children:"Upcoming gatherings and activities"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"flex items-center border rounded-lg p-1",children:[s.jsx(g,{variant:"grid"===o?"default":"ghost",size:"sm",onClick:()=>c("grid"),children:s.jsx(we,{className:"h-4 w-4"})}),s.jsx(g,{variant:"list"===o?"default":"ghost",size:"sm",onClick:()=>c("list"),children:s.jsx(Ce,{className:"h-4 w-4"})}),s.jsx(g,{variant:"calendar"===o?"default":"ghost",size:"sm",onClick:()=>c("calendar"),children:s.jsx(ie,{className:"h-4 w-4"})})]}),a&&(n||r)&&s.jsxs(z,{open:j,onOpenChange:y,children:[s.jsx(H,{asChild:!0,children:s.jsxs(g,{"data-testid":"button-create-event",children:[s.jsx(de,{className:"h-4 w-4 mr-2"}),"New Event"]})}),s.jsxs(U,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(B,{children:[s.jsx(q,{children:"Create Community Event"}),s.jsxs(Y,{children:["Plan a new event for the ",t.name," community"]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Event Title *"}),s.jsx(E,{placeholder:"What's the event called?",value:b.title,onChange:e=>N({...b,title:e.target.value}),"data-testid":"input-event-title"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Description *"}),s.jsx(Re,{placeholder:"Describe your event...",value:b.description,onChange:e=>N({...b,description:e.target.value}),className:"min-h-24 resize-none","data-testid":"textarea-event-description"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Start Date *"}),s.jsx(E,{type:"date",value:b.startDate,onChange:e=>N({...b,startDate:e.target.value}),"data-testid":"input-start-date"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Start Time *"}),s.jsx(E,{type:"time",value:b.startTime,onChange:e=>N({...b,startTime:e.target.value}),"data-testid":"input-start-time"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"End Date"}),s.jsx(E,{type:"date",value:b.endDate,onChange:e=>N({...b,endDate:e.target.value})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"End Time"}),s.jsx(E,{type:"time",value:b.endTime,onChange:e=>N({...b,endTime:e.target.value})})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Location"}),s.jsx(E,{placeholder:"Where is the event?",value:b.location,onChange:e=>N({...b,location:e.target.value})}),s.jsxs("div",{className:"flex items-center mt-2",children:[s.jsx("input",{type:"checkbox",id:"isOnline",checked:b.isOnline,onChange:e=>N({...b,isOnline:e.target.checked}),className:"mr-2"}),s.jsx("label",{htmlFor:"isOnline",className:"text-sm",children:"This is an online event"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Max Attendees"}),s.jsx(E,{type:"number",placeholder:"Leave blank for unlimited",value:b.maxAttendees,onChange:e=>N({...b,maxAttendees:e.target.value})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium",children:"Tags"}),s.jsx(E,{placeholder:"fellowship, worship, study (comma-separated)",value:b.tags,onChange:e=>N({...b,tags:e.target.value})})]})]}),s.jsxs(K,{children:[s.jsx(g,{variant:"outline",onClick:()=>y(!1),disabled:_.isPending,children:"Cancel"}),s.jsx(g,{onClick:()=>{if(!(b.title.trim()&&b.description.trim()&&b.startDate&&b.startTime))return void l({title:"Missing information",description:"Please fill in all required fields.",variant:"destructive"});const e=new Date(`${b.startDate}T${b.startTime}`),s=b.endDate&&b.endTime?new Date(`${b.endDate}T${b.endTime}`):void 0;_.mutate({title:b.title,description:b.description,startDateTime:e.toISOString(),endDateTime:s?.toISOString(),location:b.location||void 0,isOnline:b.isOnline,maxAttendees:b.maxAttendees?parseInt(b.maxAttendees):void 0,tags:b.tags.split(",").map(e=>e.trim()).filter(Boolean)})},disabled:_.isPending,"data-testid":"button-submit-event",children:_.isPending?s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):s.jsxs(s.Fragment,{children:[s.jsx(ee,{className:"h-4 w-4 mr-2"}),"Create Event"]})})]})]})]})]})]}),s.jsxs(A,{value:d,onValueChange:e=>p(e),children:[s.jsxs(F,{children:[s.jsx($,{value:"all",children:"All Events"}),s.jsx($,{value:"upcoming",children:"Upcoming"}),s.jsx($,{value:"past",children:"Past"}),a&&s.jsxs(s.Fragment,{children:[s.jsx($,{value:"attending",children:"Attending"}),(n||r)&&s.jsx($,{value:"hosting",children:"Hosting"})]})]}),s.jsxs(W,{value:d,className:"mt-6",children:["calendar"===o&&s.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-1",children:s.jsx(xn,{mode:"single",selected:v,onSelect:e=>e&&f(e),modifiers:{hasEvent:e=>I(e).length>0},modifiersStyles:{hasEvent:{backgroundColor:"hsl(var(--primary))",color:"hsl(var(--primary-foreground))",fontWeight:"bold"}},className:"rounded-md border"})}),s.jsxs("div",{className:"lg:col-span-2",children:[s.jsxs("h3",{className:"font-semibold mb-4",children:["Events on ",es(v,"MMMM d, yyyy")]}),0===I(v).length?s.jsx("p",{className:"text-muted-foreground",children:"No events scheduled for this date."}):s.jsx("div",{className:"space-y-4",children:I(v).map(e=>s.jsx(jn,{event:e,onRSVP:O,isMember:a,compact:!0},e.id))})]})]}),"grid"===o&&s.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:C?Array.from({length:6}).map((e,t)=>s.jsxs(P,{className:"animate-pulse",children:[s.jsxs(D,{children:[s.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),s.jsx("div",{className:"h-3 bg-muted rounded w-1/2"})]}),s.jsx(M,{children:s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"h-3 bg-muted rounded w-full"}),s.jsx("div",{className:"h-3 bg-muted rounded w-2/3"})]})})]},t)):0===w.length?s.jsxs("div",{className:"col-span-full text-center py-12",children:[s.jsx(Ne,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No events found"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"upcoming"===d?"No upcoming events scheduled.":`No ${d} events.`}),a&&(n||r)&&"upcoming"===d&&s.jsxs(g,{onClick:()=>y(!0),children:[s.jsx(de,{className:"h-4 w-4 mr-2"}),"Create First Event"]})]}):w.map(e=>s.jsx(jn,{event:e,onRSVP:O,isMember:a},e.id))}),"list"===o&&s.jsx("div",{className:"space-y-4",children:C?Array.from({length:4}).map((e,t)=>s.jsx(P,{className:"animate-pulse",children:s.jsxs(M,{className:"flex items-center space-x-4 p-6",children:[s.jsx("div",{className:"w-16 h-16 bg-muted rounded-lg"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx("div",{className:"h-4 bg-muted rounded w-1/2"}),s.jsx("div",{className:"h-3 bg-muted rounded w-1/3"})]})]})},t)):0===w.length?s.jsx(P,{children:s.jsxs(M,{className:"text-center py-12",children:[s.jsx(Ne,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No events found"}),s.jsx("p",{className:"text-muted-foreground",children:"No events match your current filter."})]})}):w.map(e=>s.jsx(jn,{event:e,onRSVP:O,isMember:a,list:!0},e.id))})]})]})]})}function jn({event:e,onRSVP:t,isMember:a,compact:n=!1,list:r=!1}){const i=(l=e.startDateTime,Ke(new Date(l),new Date));var l;return(e=>{ss(new Date(e),new Date)})(e.startDateTime),r?s.jsx(P,{className:"overflow-hidden "+(i?"opacity-75":""),"data-testid":`event-${e.id}`,children:s.jsxs(M,{className:"flex items-center space-x-6 p-6",children:[s.jsxs("div",{className:"text-center bg-primary/10 p-4 rounded-lg min-w-[80px]",children:[s.jsx("div",{className:"text-2xl font-bold text-primary",children:es(new Date(e.startDateTime),"d")}),s.jsx("div",{className:"text-sm text-muted-foreground uppercase",children:es(new Date(e.startDateTime),"MMM")})]}),s.jsx("div",{className:"flex-1 min-w-0",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"font-semibold text-lg truncate",children:e.title}),s.jsxs("div",{className:"flex items-center text-sm text-muted-foreground space-x-4 mt-1",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(le,{className:"h-4 w-4 mr-1"}),pn(e.startDateTime,e.endDateTime)]}),e.location&&s.jsxs("div",{className:"flex items-center",children:[s.jsx(Se,{className:"h-4 w-4 mr-1"}),e.location]}),e.isOnline&&s.jsx(C,{variant:"secondary",children:"Online"})]}),s.jsx("p",{className:"text-sm text-muted-foreground mt-2 line-clamp-2",children:e.description})]}),a&&!i&&s.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[s.jsxs(g,{variant:"attending"===e.userRsvp?.status?"default":"outline",size:"sm",onClick:()=>t(e.id,"attending"),children:[s.jsx(Pe,{className:"h-4 w-4 mr-1"}),"Going"]}),s.jsxs(g,{variant:"maybe"===e.userRsvp?.status?"default":"outline",size:"sm",onClick:()=>t(e.id,"maybe"),children:[s.jsx(De,{className:"h-4 w-4 mr-1"}),"Maybe"]}),s.jsxs(g,{variant:"declined"===e.userRsvp?.status?"default":"outline",size:"sm",onClick:()=>t(e.id,"declined"),children:[s.jsx(ke,{className:"h-4 w-4 mr-1"}),"Can't Go"]})]})]})})]})}):s.jsxs(P,{className:`overflow-hidden ${i?"opacity-75":""} ${n?"h-fit":""}`,"data-testid":`event-${e.id}`,children:[e.imageUrl&&s.jsx("div",{className:"aspect-video overflow-hidden",children:s.jsx("img",{src:e.imageUrl,alt:e.title,className:"w-full h-full object-cover"})}),s.jsx(D,{className:n?"pb-2":"",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx(k,{className:"line-clamp-2",children:e.title}),s.jsxs("div",{className:"flex items-center text-sm text-muted-foreground space-x-2 mt-2",children:[s.jsx(le,{className:"h-4 w-4"}),s.jsx("span",{children:vn(e.startDateTime)})]})]}),i&&s.jsx(C,{variant:"secondary",children:"Past"}),e.isOnline&&s.jsx(C,{variant:"outline",children:"Online"})]})}),s.jsxs(M,{className:n?"pt-0":"",children:[!n&&s.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3 mb-4",children:e.description}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center text-sm text-muted-foreground space-x-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(ue,{className:"h-4 w-4 mr-1"}),s.jsxs("span",{children:[e.attendeeCount," attending"]})]}),e.location&&s.jsxs("div",{className:"flex items-center",children:[s.jsx(Se,{className:"h-4 w-4 mr-1"}),s.jsx("span",{className:"truncate max-w-24",children:e.location})]})]}),a&&!i&&!n&&s.jsxs(Us,{onValueChange:s=>t(e.id,s),children:[s.jsx(Bs,{className:"w-32",children:s.jsx(qs,{placeholder:"RSVP"})}),s.jsxs(Ys,{children:[s.jsx(Ks,{value:"attending",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Pe,{className:"h-4 w-4 mr-2 text-green-600"}),"Going"]})}),s.jsx(Ks,{value:"maybe",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(De,{className:"h-4 w-4 mr-2 text-yellow-600"}),"Maybe"]})}),s.jsx(Ks,{value:"declined",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(ke,{className:"h-4 w-4 mr-2 text-red-600"}),"Can't Go"]})})]})]})]}),e.tags&&e.tags.length>0&&!n&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-3",children:e.tags.map((e,t)=>s.jsx(C,{variant:"outline",className:"text-xs",children:e},t))})]})]})}function yn(){const t=O(),[,a]=I(),{user:n}=m(),{toast:r}=u(),i=t.slug,[l,o]=e.useState(!1),[c,d]=e.useState(!1),[p,v]=e.useState(!1),{data:f,isLoading:C,error:S}=L({queryKey:[`/api/communities/${i}`],enabled:!!i}),{data:P,isLoading:D,error:k}=L({queryKey:[`/api/communities/${f?.id}/members`],enabled:!!f?.id&&!!n,select:e=>n&&e.find(e=>e.userId===n.id)||null}),_="owner"===P?.role,M="moderator"===P?.role,E=!!P,T=R({mutationFn:async()=>{if(!f)throw new Error("Community not found");const e=await x("POST",`/api/communities/${f.id}/members`,{});return await e.json()},onSuccess:()=>{f&&(h.invalidateQueries({queryKey:[`/api/communities/${f.id}/members`]}),r({title:"Joined community",description:`You are now a member of ${f.name}`}),o(!1))},onError:e=>{r({title:"Failed to join community",description:e.message,variant:"destructive"})}}),Q=R({mutationFn:async()=>{n&&f&&await x("DELETE",`/api/communities/${f.id}/members/${n.id}`)},onSuccess:()=>{f&&(h.invalidateQueries({queryKey:[`/api/communities/${f.id}/members`]}),r({title:"Left community",description:`You have left ${f.name}`}),d(!1))},onError:e=>{r({title:"Failed to leave community",description:e.message,variant:"destructive"})}}),ee=R({mutationFn:async()=>{if(!f)throw new Error("Community not found");await x("DELETE",`/api/communities/${f.id}`)},onSuccess:()=>{f&&(h.invalidateQueries({queryKey:["/api/communities"]}),r({title:"Community deleted",description:`${f.name} has been permanently deleted`}),a("/communities"))},onError:e=>{r({title:"Failed to delete community",description:e.message,variant:"destructive"})}});return C||n&&D?s.jsxs("div",{className:"flex justify-center items-center min-h-[600px]",children:[s.jsx(V,{className:"h-8 w-8 animate-spin text-primary"}),s.jsx("span",{className:"ml-2",children:"Loading community..."})]}):S||k?s.jsx("div",{className:"container max-w-6xl mx-auto px-4 py-8",children:s.jsxs("div",{className:"p-6 text-center",children:[s.jsx(re,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Error Loading Community"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:S?.message||k?.message||"Failed to load community details."}),s.jsx(g,{onClick:()=>a("/communities"),children:"Back to Communities"})]})}):f?s.jsxs("div",{className:"container max-w-6xl mx-auto px-4 py-8",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:f.name}),s.jsx("p",{className:"text-muted-foreground mt-1",children:f.description}),s.jsxs("div",{className:"flex items-center gap-4 mt-3",children:[s.jsxs("div",{className:"flex items-center text-muted-foreground",children:[s.jsx(ue,{className:"mr-1 h-4 w-4"}),s.jsxs("span",{children:[f.memberCount||0," members"]})]}),f.isPrivate&&s.jsxs("div",{className:"flex items-center text-amber-500",children:[s.jsx(se,{className:"mr-1 h-4 w-4"}),s.jsx("span",{children:"Private Community"})]}),f.hasPrivateWall&&!f.isPrivate&&s.jsxs("div",{className:"flex items-center text-amber-500",children:[s.jsx(se,{className:"mr-1 h-4 w-4"}),s.jsx("span",{children:"Private Wall"})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[n?E?s.jsxs(z,{open:c,onOpenChange:d,children:[s.jsx(H,{asChild:!0,children:s.jsxs(g,{variant:"outline",children:[s.jsx(X,{className:"mr-2 h-4 w-4"}),"Leave"]})}),s.jsxs(U,{children:[s.jsxs(B,{children:[s.jsx(q,{children:"Leave Community"}),s.jsxs(Y,{children:["Are you sure you want to leave ",f.name,"? You'll lose access to private content and chat rooms.",_&&s.jsxs("div",{className:"mt-2 text-destructive",children:[s.jsx(G,{className:"inline h-4 w-4 mr-1"}),"Warning: You are the owner of this community. If you leave, ownership must be transferred first."]})]})]}),s.jsxs(K,{className:"gap-2 sm:gap-0",children:[s.jsx(g,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),s.jsx(g,{variant:_?"outline":"destructive",onClick:()=>{Q.mutate()},disabled:_||Q.isPending,children:Q.isPending?s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Leaving..."]}):"Leave Community"})]})]})]}):f.isPrivate?s.jsxs("div",{className:"text-center",children:[s.jsxs(g,{variant:"outline",disabled:!0,"data-testid":"button-invitation-required",children:[s.jsx(se,{className:"mr-2 h-4 w-4"}),"Invitation Required"]}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"This is a private community"})]}):s.jsxs(z,{open:l,onOpenChange:o,children:[s.jsx(H,{asChild:!0,children:s.jsxs(g,{"data-testid":"button-join-community",children:[s.jsx(Z,{className:"mr-2 h-4 w-4"}),"Join"]})}),s.jsxs(U,{children:[s.jsxs(B,{children:[s.jsx(q,{children:"Join Community"}),s.jsxs(Y,{children:["You're about to join ",f.name,". Members can access private chat rooms and participate in discussions."]})]}),s.jsx(K,{children:s.jsx(g,{onClick:()=>{T.mutate()},disabled:T.isPending,"data-testid":"button-confirm-join",children:T.isPending?s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Joining..."]}):"Join Community"})})]})]}):s.jsx(g,{onClick:()=>a("/auth"),children:"Sign In to Join"}),(_||M)&&s.jsxs(j,{children:[s.jsx(y,{asChild:!0,children:s.jsx(g,{variant:"ghost",size:"icon",children:s.jsx(J,{className:"h-5 w-5"})})}),s.jsxs(b,{align:"end",children:[s.jsx(At,{communityId:f.id.toString(),communityName:f.name,children:s.jsxs(N,{onSelect:e=>e.preventDefault(),"data-testid":"menu-invite-member",children:[s.jsx(Z,{className:"mr-2 h-4 w-4"}),s.jsx("span",{children:"Invite Member"})]})}),s.jsx(w,{}),s.jsxs(N,{children:[s.jsx(_e,{className:"mr-2 h-4 w-4"}),s.jsx("span",{children:"Edit Community"})]}),s.jsxs(N,{children:[s.jsx(Me,{className:"mr-2 h-4 w-4"}),s.jsx("span",{children:"Community Settings"})]}),_&&s.jsxs(s.Fragment,{children:[s.jsx(w,{}),s.jsxs(z,{open:p,onOpenChange:v,children:[s.jsx(H,{asChild:!0,children:s.jsxs(N,{className:"text-destructive focus:text-destructive",children:[s.jsx(Ee,{className:"mr-2 h-4 w-4"}),s.jsx("span",{children:"Delete Community"})]})}),s.jsxs(U,{children:[s.jsxs(B,{children:[s.jsx(q,{children:"Delete Community"}),s.jsxs(Y,{children:["Are you sure you want to delete ",f.name,"? This action is permanent and will delete all content, chat rooms, and member relationships."]})]}),s.jsxs("div",{className:"bg-destructive/10 text-destructive p-3 rounded-md",children:[s.jsx(re,{className:"h-5 w-5 mb-2"}),s.jsx("p",{className:"text-sm",children:"This is a permanent action and cannot be undone. All content will be permanently deleted."})]}),s.jsxs(K,{className:"gap-2 sm:gap-0",children:[s.jsx(g,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),s.jsx(g,{variant:"destructive",onClick:()=>{ee.mutate()},disabled:ee.isPending,children:ee.isPending?s.jsxs(s.Fragment,{children:[s.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete Community"})]})]})]})]})]})]})]})]}),f.isPrivate&&!E?s.jsxs("div",{className:"text-center py-16",children:[s.jsx("div",{className:"mx-auto mb-6 p-4 rounded-full bg-amber-50 w-fit",children:s.jsx(se,{className:"h-12 w-12 text-amber-600"})}),s.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Private Community"}),s.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"This is a private community. You need an invitation from a community administrator to join and access the content."}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"If you have received an invitation email, click the invitation link to join."}),s.jsx(g,{onClick:()=>a("/communities"),variant:"outline","data-testid":"button-browse-other-communities",children:"Browse Other Communities"})]})]}):s.jsxs(A,{defaultValue:"feed",className:"space-y-6 community-tabs",children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(F,{className:"grid w-full grid-cols-5 min-w-fit lg:grid-cols-5 md:grid-cols-5 sm:grid-cols-3",children:[s.jsxs($,{value:"forum",children:[s.jsx(Te,{className:"h-4 w-4 mr-2"}),"Forum"]}),s.jsxs($,{value:"events",children:[s.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Events"]}),s.jsxs($,{value:"feed",children:[s.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Feed"]}),s.jsxs($,{value:"chat",children:[s.jsx(fe,{className:"h-4 w-4 mr-2"}),"Chat"]}),s.jsxs($,{value:"members",children:[s.jsx(ue,{className:"h-4 w-4 mr-2"}),"Members"]})]})}),s.jsx(W,{value:"forum",className:"mt-6",children:s.jsx(zt,{community:f,isMember:E,isOwner:_,isModerator:M})}),s.jsx(W,{value:"events",className:"mt-6",children:s.jsx(fn,{community:f,isMember:E,isOwner:_,isModerator:M})}),s.jsx(W,{value:"feed",className:"mt-6",children:s.jsx($t,{community:f,isMember:E,isOwner:_,isModerator:M})}),s.jsx(W,{value:"chat",className:"mt-6",children:s.jsx(Lt,{communityId:f.id,isOwner:_,isModerator:M,isMember:E})}),s.jsx(W,{value:"members",className:"mt-6",children:s.jsxs("div",{className:"space-y-6",children:[(_||M)&&s.jsx(Ft,{communityId:f.id.toString(),communityName:f.name}),s.jsx(Hs,{communityId:f.id,isOwner:_,isModerator:M})]})})]})]}):s.jsx("div",{className:"container max-w-6xl mx-auto px-4 py-8",children:s.jsxs("div",{className:"p-6 text-center",children:[s.jsx(re,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Community Not Found"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"The community you're looking for doesn't exist or has been deleted."}),s.jsx(g,{onClick:()=>a("/communities"),children:"Back to Communities"})]})})}export{yn as default};
