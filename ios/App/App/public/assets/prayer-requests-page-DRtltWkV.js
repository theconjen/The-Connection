import{r as e,j as s}from"./vendor-radix-Cb0-vzxO.js";import{u as r,a}from"./vendor-query-qkAKzVJ0.js";import{u as i,h as n,B as t,C as l,a as d,I as c,q as o,i as m}from"./index-CQmKbNyS.js";import{M as h}from"./main-layout-BqoyFj5l.js";import{T as u,a as x,b as p,c as y}from"./tabs-N8_zO4xm.js";import{D as j,b as f,c as w,d as v,e as N,f as b}from"./dialog-BfqlROKo.js";import{u as g,F as q,a as P,b as A,c as S,d as C,f as k,e as R,t as F}from"./form-Z2c2XcTx.js";import{L as K}from"./label-BZLDYjV_.js";import{T as L}from"./textarea-BQP-18ak.js";import{R as T,a as O}from"./radio-group-Cg5EhD0u.js";import{S as V}from"./skeleton-D3l7g_Rg.js";import{P as G,az as I,I as Y}from"./vendor-icons-CM8Yk8yJ.js";import{a as E}from"./vendor-utils-nlnd1Dju.js";import{o as M,b as Q,n as D,e as H,s as $}from"./types-DUVubNlp.js";import"./vendor-react-eVk5PToZ.js";const z=M({title:$().min(3,"Title must be at least 3 characters").max(100,"Title must be less than 100 characters"),content:$().min(10,"Request must be at least 10 characters").max(1e3,"Request must be less than 1000 characters"),privacyLevel:H(["public","friends-only","group-only"]),groupId:D().optional().nullable(),isAnonymous:Q().default(!1)});function B(){const{user:I}=i(),{toast:Y}=n(),[E,M]=e.useState(!1),[Q,D]=e.useState("all"),{data:H,isLoading:$}=r({queryKey:["/api/prayer-requests"]}),{data:B,isLoading:W}=r({queryKey:["/api/users",I?.id,"prayer-requests"],enabled:!!I}),{data:J,isLoading:X}=r({queryKey:["/api/users",I?.id,"prayed"],enabled:!!I}),Z=a({mutationFn:async e=>{const s=await m("POST","/api/prayer-requests",e);return await s.json()},onSuccess:()=>{Y({title:"Prayer request created",description:"Your prayer request has been shared with the community."}),o.invalidateQueries({queryKey:["/api/prayer-requests"]}),o.invalidateQueries({queryKey:["/api/users",I?.id,"prayer-requests"]}),M(!1),se.reset()},onError:e=>{Y({title:"Error creating prayer request",description:e.message,variant:"destructive"})}}),_=a({mutationFn:async e=>{const s=await m("POST",`/api/prayer-requests/${e}/pray`);return await s.json()},onSuccess:(e,s)=>{Y({title:"Prayer recorded",description:"Thank you for praying for this request."}),o.invalidateQueries({queryKey:["/api/prayer-requests"]}),o.invalidateQueries({queryKey:["/api/users",I?.id,"prayed"]}),o.invalidateQueries({queryKey:[`/api/prayer-requests/${s}/prayers`]})},onError:e=>{Y({title:"Error recording prayer",description:e.message,variant:"destructive"})}}),ee=a({mutationFn:async({id:e,description:s})=>{const r=await m("POST",`/api/prayer-requests/${e}/answer`,{description:s});return await r.json()},onSuccess:()=>{Y({title:"Prayer marked as answered",description:"Praise God! Your testimony has been shared."}),o.invalidateQueries({queryKey:["/api/prayer-requests"]}),o.invalidateQueries({queryKey:["/api/users",I?.id,"prayer-requests"]})},onError:e=>{Y({title:"Error marking prayer as answered",description:e.message,variant:"destructive"})}}),se=g({resolver:F(z),defaultValues:{title:"",content:"",privacyLevel:"public",groupId:null,isAnonymous:!1}}),[re,ae]=e.useState(!1),[ie,ne]=e.useState(null),[te,le]=e.useState(""),de=e=>{I?_.mutate(e):Y({title:"Sign in required",description:"Please sign in to pray for this request.",variant:"destructive"})},ce=e=>{ne(e),ae(!0)},oe=e=>J?.includes(e)||!1;return s.jsxs(h,{children:[s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Prayer Requests"}),s.jsx("p",{className:"text-muted-foreground mt-1",children:"Support each other through prayer"})]}),I&&s.jsxs(t,{onClick:()=>M(!0),children:[s.jsx(G,{className:"mr-2 h-4 w-4"}),"Share Prayer Request"]})]}),s.jsxs(u,{defaultValue:"all",value:Q,onValueChange:D,className:"mt-6",children:[s.jsxs(x,{className:"mb-4",children:[s.jsx(p,{value:"all",children:"All Requests"}),I&&s.jsx(p,{value:"my",children:"My Requests"}),I&&s.jsx(p,{value:"prayed",children:"I've Prayed For"}),s.jsx(p,{value:"answered",children:"Answered Prayers"})]}),s.jsx(y,{value:"all",children:s.jsx("div",{className:"space-y-4",children:$?Array.from({length:3}).map((e,r)=>s.jsx(l,{children:s.jsxs(d,{className:"p-6",children:[s.jsx(V,{className:"h-6 w-3/4 mb-2"}),s.jsx(V,{className:"h-4 w-1/4 mb-4"}),s.jsx(V,{className:"h-20 w-full mb-4"}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx(V,{className:"h-9 w-20"}),s.jsx(V,{className:"h-9 w-16"})]})]})},r)):H&&H.length>0?H.map(e=>s.jsx(U,{prayer:e,hasPrayed:oe(e.id),onPrayClick:de,onMarkAsAnswered:e.authorId===I?.id?()=>ce(e.id):void 0},e.id)):s.jsx(l,{children:s.jsxs(d,{className:"p-6 text-center",children:[s.jsx("h3",{className:"text-lg font-medium mb-2",children:"No prayer requests yet"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"Be the first to share a prayer request with the community."}),I?s.jsxs(t,{onClick:()=>M(!0),children:[s.jsx(G,{className:"mr-2 h-4 w-4"}),"Share Prayer Request"]}):s.jsx("p",{children:"Please sign in to share a prayer request."})]})})})}),s.jsx(y,{value:"my",children:s.jsx("div",{className:"space-y-4",children:W?Array.from({length:2}).map((e,r)=>s.jsx(l,{children:s.jsxs(d,{className:"p-6",children:[s.jsx(V,{className:"h-6 w-3/4 mb-2"}),s.jsx(V,{className:"h-4 w-1/4 mb-4"}),s.jsx(V,{className:"h-20 w-full mb-4"}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx(V,{className:"h-9 w-20"}),s.jsx(V,{className:"h-9 w-16"})]})]})},r)):B&&B.length>0?B.map(e=>s.jsx(U,{prayer:e,hasPrayed:oe(e.id),onPrayClick:de,onMarkAsAnswered:e.isAnswered?void 0:()=>ce(e.id),showStats:!0},e.id)):s.jsx(l,{children:s.jsxs(d,{className:"p-6 text-center",children:[s.jsx("h3",{className:"text-lg font-medium mb-2",children:"You haven't shared any prayer requests"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"Share your prayer needs with the community."}),s.jsxs(t,{onClick:()=>M(!0),children:[s.jsx(G,{className:"mr-2 h-4 w-4"}),"Share Prayer Request"]})]})})})}),s.jsx(y,{value:"prayed",children:s.jsx("div",{className:"space-y-4",children:X||$?Array.from({length:2}).map((e,r)=>s.jsx(l,{children:s.jsxs(d,{className:"p-6",children:[s.jsx(V,{className:"h-6 w-3/4 mb-2"}),s.jsx(V,{className:"h-4 w-1/4 mb-4"}),s.jsx(V,{className:"h-20 w-full mb-4"}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx(V,{className:"h-9 w-20"}),s.jsx(V,{className:"h-9 w-16"})]})]})},r)):H&&J&&J.length>0?H.filter(e=>J.includes(e.id)).map(e=>s.jsx(U,{prayer:e,hasPrayed:!0,onPrayClick:de,onMarkAsAnswered:e.authorId===I?.id?()=>ce(e.id):void 0},e.id)):s.jsx(l,{children:s.jsxs(d,{className:"p-6 text-center",children:[s.jsx("h3",{className:"text-lg font-medium mb-2",children:"You haven't prayed for any requests yet"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"Browse the prayer requests and support others through prayer."}),s.jsx(t,{onClick:()=>D("all"),children:"View All Prayer Requests"})]})})})}),s.jsx(y,{value:"answered",children:s.jsx("div",{className:"space-y-4",children:$?Array.from({length:2}).map((e,r)=>s.jsx(l,{children:s.jsxs(d,{className:"p-6",children:[s.jsx(V,{className:"h-6 w-3/4 mb-2"}),s.jsx(V,{className:"h-4 w-1/4 mb-4"}),s.jsx(V,{className:"h-20 w-full mb-4"}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx(V,{className:"h-9 w-20"}),s.jsx(V,{className:"h-9 w-16"})]})]})},r)):H&&H.filter(e=>e.isAnswered).length>0?H.filter(e=>e.isAnswered).map(e=>s.jsx(U,{prayer:e,hasPrayed:oe(e.id),onPrayClick:de,showAnsweredDescription:!0},e.id)):s.jsx(l,{children:s.jsxs(d,{className:"p-6 text-center",children:[s.jsx("h3",{className:"text-lg font-medium mb-2",children:"No answered prayers yet"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"When prayers are answered, they'll appear here as testimonies."}),s.jsx(t,{onClick:()=>D("all"),children:"View All Prayer Requests"})]})})})})]})]}),s.jsx(j,{open:E,onOpenChange:M,children:s.jsxs(f,{className:"sm:max-w-[550px]",children:[s.jsxs(w,{children:[s.jsx(v,{children:"Share a Prayer Request"}),s.jsx(N,{children:"Share your prayer needs with the community. Others will be able to pray for you."})]}),s.jsx(q,{...se,children:s.jsxs("form",{onSubmit:se.handleSubmit(e=>{Z.mutate(e)}),className:"space-y-6",children:[s.jsx(P,{control:se.control,name:"title",render:({field:e})=>s.jsxs(A,{children:[s.jsx(S,{children:"Title"}),s.jsx(C,{children:s.jsx(c,{placeholder:"Prayer request title",...e})}),s.jsx(k,{children:"A brief title for your prayer request."}),s.jsx(R,{})]})}),s.jsx(P,{control:se.control,name:"content",render:({field:e})=>s.jsxs(A,{children:[s.jsx(S,{children:"Prayer Request"}),s.jsx(C,{children:s.jsx(L,{placeholder:"Share your prayer need here...",className:"min-h-[120px]",...e})}),s.jsx(k,{children:"Share details about your prayer need."}),s.jsx(R,{})]})}),s.jsx(P,{control:se.control,name:"privacyLevel",render:({field:e})=>s.jsxs(A,{children:[s.jsx(S,{children:"Privacy Level"}),s.jsx(C,{children:s.jsxs(T,{onValueChange:e.onChange,defaultValue:e.value,className:"flex flex-col space-y-1",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(O,{value:"public",id:"privacy-public"}),s.jsx(K,{htmlFor:"privacy-public",children:"Public - Visible to all community members"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(O,{value:"friends-only",id:"privacy-friends"}),s.jsx(K,{htmlFor:"privacy-friends",children:"Friends Only - Visible only to your friends"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(O,{value:"group-only",id:"privacy-group",disabled:!0}),s.jsx(K,{htmlFor:"privacy-group",className:"text-muted-foreground",children:"Group Only - Visible only within a specific group (Coming soon)"})]})]})}),s.jsx(R,{})]})}),s.jsx(P,{control:se.control,name:"isAnonymous",render:({field:e})=>s.jsxs(A,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[s.jsx(C,{children:s.jsx("input",{type:"checkbox",className:"h-4 w-4 mt-1",checked:e.value,onChange:e.onChange})}),s.jsxs("div",{className:"space-y-1 leading-none",children:[s.jsx(S,{children:"Post Anonymously"}),s.jsx(k,{children:"Your name won't be shown with this prayer request."})]})]})}),s.jsxs(b,{children:[s.jsx(t,{type:"button",variant:"outline",onClick:()=>M(!1),children:"Cancel"}),s.jsx(t,{type:"submit",disabled:Z.isPending,children:Z.isPending?"Submitting...":"Share Prayer Request"})]})]})})]})}),s.jsx(j,{open:re,onOpenChange:ae,children:s.jsxs(f,{className:"sm:max-w-[550px]",children:[s.jsxs(w,{children:[s.jsx(v,{children:"Share How God Answered Your Prayer"}),s.jsx(N,{children:"Share your testimony of how God answered this prayer. Your testimony will encourage the community."})]}),s.jsx("div",{className:"space-y-4 py-4",children:s.jsxs("div",{className:"space-y-2",children:[s.jsx(K,{htmlFor:"answer-description",children:"How was your prayer answered?"}),s.jsx(L,{id:"answer-description",placeholder:"Share how God answered your prayer...",className:"min-h-[150px]",value:te,onChange:e=>le(e.target.value)}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Your testimony will be shared with the community."})]})}),s.jsxs(b,{children:[s.jsx(t,{type:"button",variant:"outline",onClick:()=>ae(!1),children:"Cancel"}),s.jsx(t,{onClick:()=>{null!==ie&&(ee.mutate({id:ie,description:te}),ae(!1),ne(null),le(""))},disabled:ee.isPending||!te.trim(),children:ee.isPending?"Submitting...":"Share Testimony"})]})]})})]})}function U({prayer:e,hasPrayed:a,onPrayClick:n,onMarkAsAnswered:c,showStats:o=!1,showAnsweredDescription:m=!1}){i();const{data:h}=r({queryKey:[`/api/prayer-requests/${e.id}/prayers`],enabled:o});return s.jsx(l,{children:s.jsxs(d,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold",children:e.title}),s.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[s.jsx("span",{children:e.isAnonymous?"Anonymous":"User "+e.authorId}),s.jsx("span",{className:"mx-2",children:"•"}),s.jsx("span",{children:(u=e.createdAt,u?E(new Date(u),{addSuffix:!0}):"Unknown date")}),"public"!==e.privacyLevel&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"mx-2",children:"•"}),s.jsx("span",{children:"friends-only"===e.privacyLevel?"Friends Only":"Group Only"})]})]})]}),e.isAnswered&&s.jsxs("div",{className:"flex items-center text-sm bg-green-100 text-green-800 px-2 py-1 rounded",children:[s.jsx(I,{className:"h-4 w-4 mr-1"}),s.jsx("span",{children:"Answered"})]})]}),s.jsx("p",{className:"my-4",children:e.content}),e.isAnswered&&m&&e.answeredDescription&&s.jsxs("div",{className:"mb-4 mt-6 bg-green-50 p-4 rounded-md border border-green-100",children:[s.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"How God Answered:"}),s.jsx("p",{className:"text-green-900",children:e.answeredDescription})]}),o&&h&&s.jsx("div",{className:"mb-4",children:s.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.prayerCount||0," people have prayed for this request"]})}),s.jsxs("div",{className:"flex justify-between items-center mt-4",children:[s.jsxs(t,{variant:a?"outline":"default",size:"sm",onClick:()=>n(e.id),disabled:a,className:"h-9 touch-target active-scale rounded-full",children:[s.jsx(Y,{className:"h-4 w-4 mr-2"}),a?"Prayed":"Pray for This"]}),c&&s.jsxs(t,{variant:"outline",size:"sm",onClick:c,className:"h-9 touch-target active-scale rounded-full",children:[s.jsx(I,{className:"h-4 w-4 mr-2"}),"Mark as Answered"]})]})]})});var u}export{B as default};
