import{r as e,j as s}from"./vendor-radix-Cb0-vzxO.js";import{u as t,a as i}from"./vendor-query-qkAKzVJ0.js";import{n as a,v as n,u as r,h as l,B as d,L as c,C as o,b as h,f as m,j as x,D as u,o as j,p as v,r as p,s as f,a as g,A as y,d as N,e as w,q as b,i as E}from"./index-CQmKbNyS.js";import{A as C,b as k,c as S,d as $,e as F,f as P,g as R,h as z}from"./alert-dialog-CyKD1gnU.js";import{F as T,a as V,T as q,b as L,W as A,c as K,L as U,d as D,E as I,e as M}from"./index-Dajqlzwd.js";import{D as _,b as Q,c as B,d as Y,e as G,g as O}from"./dialog-BfqlROKo.js";import{T as J,a as W,b as H,c as X}from"./tabs-N8_zO4xm.js";import{S as Z}from"./separator-BRrBbODb.js";import{A as ee,ah as se,o as te,m as ie,ay as ae,i as ne,ak as re,U as le}from"./vendor-icons-CM8Yk8yJ.js";import{f as de}from"./vendor-utils-nlnd1Dju.js";import"./vendor-react-eVk5PToZ.js";import"./index-BTJIN2si.js";function ce(){const[,ce]=a(),oe=n(),he=parseInt(oe.id),{user:me}=r(),{toast:xe}=l(),[ue,je]=e.useState(!1),[ve,pe]=e.useState(!1),[fe,ge]=e.useState(null),[ye,Ne]=e.useState(""),{data:we,isLoading:be}=t({queryKey:[`/api/events/${he}`],queryFn:async()=>{const e=await fetch(`/api/events/${he}`);if(!e.ok){if(404===e.status)throw new Error("Event not found");throw new Error("Failed to fetch event")}return e.json()}}),{data:Ee=[],isLoading:Ce}=t({queryKey:[`/api/events/${he}/rsvps`],queryFn:async()=>{const e=await fetch(`/api/events/${he}/rsvps`);if(!e.ok)throw new Error("Failed to fetch RSVPs");return e.json()},enabled:!!we}),{data:ke,isLoading:Se}=t({queryKey:[`/api/events/${he}/rsvp`],queryFn:async()=>{const e=await fetch(`/api/events/${he}/rsvp`);if(!e.ok){if(404===e.status)return null;throw new Error("Failed to fetch your RSVP")}return e.json()},enabled:!!me&&!!we});e.useEffect(()=>{ke&&ge(ke.status)},[ke]),e.useEffect(()=>{Ne(window.location.href)},[]);const $e=i({mutationFn:async e=>{const s=await E("POST",`/api/events/${he}/rsvp`,{status:e});if(!s.ok){const e=await s.json();throw new Error(e.message||"Failed to RSVP")}return s.json()},onSuccess:()=>{xe({title:"RSVP Successful",description:"Your RSVP has been recorded."}),b.invalidateQueries({queryKey:[`/api/events/${he}/rsvps`]}),b.invalidateQueries({queryKey:[`/api/events/${he}/rsvp`]})},onError:e=>{xe({title:"Failed to RSVP",description:e.message,variant:"destructive"})}}),Fe=i({mutationFn:async e=>{const s=await E("PATCH",`/api/events/${he}/rsvp`,{status:e});if(!s.ok){const e=await s.json();throw new Error(e.message||"Failed to update RSVP")}return s.json()},onSuccess:()=>{xe({title:"RSVP Updated",description:"Your RSVP has been updated."}),b.invalidateQueries({queryKey:[`/api/events/${he}/rsvps`]}),b.invalidateQueries({queryKey:[`/api/events/${he}/rsvp`]})},onError:e=>{xe({title:"Failed to update RSVP",description:e.message,variant:"destructive"})}}),Pe=i({mutationFn:async()=>{const e=await E("DELETE",`/api/events/${he}`,{});if(!e.ok){const s=await e.json();throw new Error(s.message||"Failed to delete event")}return e.json()},onSuccess:()=>{xe({title:"Event Deleted",description:"The event has been successfully deleted."}),ce("/events"),b.invalidateQueries({queryKey:["/api/events"]}),b.invalidateQueries({queryKey:["/api/events/public"]})},onError:e=>{xe({title:"Failed to delete event",description:e.message,variant:"destructive"})}}),Re=e=>{ge(e),ke?Fe.mutate(e):$e.mutate(e)};if(be)return s.jsx("div",{className:"container py-8",children:s.jsxs("div",{className:"animate-pulse space-y-4",children:[s.jsx("div",{className:"h-8 w-2/3 bg-primary/20 rounded"}),s.jsx("div",{className:"h-4 w-1/3 bg-primary/20 rounded"}),s.jsx("div",{className:"h-64 bg-primary/10 rounded-lg"})]})});if(!we)return s.jsx("div",{className:"container py-8",children:s.jsxs("div",{className:"text-center py-12",children:[s.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Event Not Found"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"The event you're looking for doesn't exist or has been removed."}),s.jsx(d,{asChild:!0,children:s.jsx(c,{href:"/events",children:"Back to Events"})})]})});const ze=Ee.filter(e=>"going"===e.status),Te=Ee.filter(e=>"maybe"===e.status);Ee.filter(e=>"not_going"===e.status);const Ve=me&&we.creatorId===me.id;return s.jsxs("div",{className:"container py-8",children:[s.jsx("div",{className:"mb-6",children:s.jsx(d,{asChild:!0,variant:"ghost",className:"gap-2",children:s.jsxs(c,{href:"/events",children:[s.jsx(ee,{size:16}),"Back to Events"]})})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsxs(o,{children:[s.jsx(h,{className:"bg-primary/5 pb-2",children:s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("div",{children:[s.jsx(m,{className:"text-2xl",children:we.title}),s.jsxs(x,{className:"flex items-center gap-1 mt-1",children:[s.jsx(se,{size:14}),(e=>{try{return de(new Date(e),"EEEE, MMMM d, yyyy")}catch(s){return e}})(we.eventDate)]})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(d,{variant:"ghost",size:"icon",onClick:()=>{pe(!0)},children:s.jsx(te,{size:18})}),Ve&&s.jsxs(u,{children:[s.jsx(j,{asChild:!0,children:s.jsx(d,{variant:"ghost",size:"icon",children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"1"}),s.jsx("circle",{cx:"12",cy:"5",r:"1"}),s.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})}),s.jsxs(v,{align:"end",children:[s.jsx(p,{asChild:!0,children:s.jsxs(c,{href:`/events/${we.id}/edit`,className:"flex items-center gap-2 cursor-pointer",children:[s.jsx(ie,{size:14}),"Edit Event"]})}),s.jsx(f,{}),s.jsxs(p,{className:"flex items-center gap-2 text-destructive cursor-pointer",onClick:()=>je(!0),children:[s.jsx(ae,{size:14}),"Delete Event"]})]})]})]})]})}),s.jsx(g,{className:"pt-4",children:s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(ne,{size:18,className:"text-muted-foreground mt-0.5"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-sm",children:"Time"}),s.jsxs("div",{children:[we.startTime," - ",we.endTime]})]})]}),we.location&&s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(re,{size:18,className:"text-muted-foreground mt-0.5"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-sm",children:"Location"}),s.jsx("div",{children:we.location})]})]}),s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(le,{size:18,className:"text-muted-foreground mt-0.5"}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-sm",children:"Attendees"}),s.jsxs("div",{children:[ze.length," Going · ",Te.length," Maybe"]})]})]})]})}),s.jsx(Z,{}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-2",children:"About this event"}),s.jsx("p",{className:"whitespace-pre-line text-muted-foreground",children:we.description})]}),we.latitude&&we.longitude&&s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium mb-2",children:"Location"}),s.jsx("div",{className:"h-64 bg-muted rounded-md overflow-hidden",children:s.jsx("iframe",{title:"Event Location",width:"100%",height:"100%",frameBorder:"0",src:`https://www.google.com/maps/embed/v1/place?key=REPLACE_WITH_YOUR_API_KEY&q=${we.latitude},${we.longitude}`,allowFullScreen:!0})}),s.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[s.jsx(re,{size:14,className:"inline mr-1"}),we.location||`${we.latitude}, ${we.longitude}`]})]})]})})]})}),s.jsxs("div",{children:[s.jsxs(o,{className:"mb-6 sticky top-4",children:[s.jsxs(h,{children:[s.jsx(m,{className:"text-lg",children:"Your RSVP"}),s.jsx(x,{children:"Let the host know if you'll be attending"})]}),s.jsx(g,{children:me?s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{onClick:()=>Re("going"),variant:"going"===fe?"default":"outline",className:"w-full justify-start",children:"✓ Going"}),s.jsx(d,{onClick:()=>Re("maybe"),variant:"maybe"===fe?"default":"outline",className:"w-full justify-start",children:"? Maybe"}),s.jsx(d,{onClick:()=>Re("not_going"),variant:"not_going"===fe?"default":"outline",className:"w-full justify-start",children:"✗ Not Going"})]}):s.jsxs("div",{className:"text-center py-4",children:[s.jsx("p",{className:"text-muted-foreground mb-4",children:"Sign in to RSVP to this event"}),s.jsx(d,{asChild:!0,children:s.jsx(c,{href:"/auth",children:"Sign In"})})]})})]}),s.jsxs(o,{children:[s.jsx(h,{children:s.jsx(m,{className:"text-lg",children:"Attendees"})}),s.jsx(g,{children:s.jsxs(J,{defaultValue:"going",children:[s.jsxs(W,{className:"w-full",children:[s.jsxs(H,{value:"going",className:"flex-1",children:["Going (",ze.length,")"]}),s.jsxs(H,{value:"maybe",className:"flex-1",children:["Maybe (",Te.length,")"]})]}),s.jsx(X,{value:"going",className:"mt-4",children:ze.length>0?s.jsx("div",{className:"space-y-4",children:ze.map(e=>s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs(y,{children:[s.jsx(N,{src:e.user?.avatarUrl||"",alt:e.user?.displayName}),s.jsx(w,{children:e.user?.displayName?.charAt(0)||"U"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.user?.displayName||"User"}),s.jsxs("div",{className:"text-xs text-muted-foreground",children:["@",e.user?.username]})]})]},e.id))}):s.jsx("div",{className:"text-center py-4",children:s.jsx("p",{className:"text-muted-foreground",children:"No one has RSVP'd as going yet"})})}),s.jsx(X,{value:"maybe",className:"mt-4",children:Te.length>0?s.jsx("div",{className:"space-y-4",children:Te.map(e=>s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs(y,{children:[s.jsx(N,{src:e.user?.avatarUrl||"",alt:e.user?.displayName}),s.jsx(w,{children:e.user?.displayName?.charAt(0)||"U"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",children:e.user?.displayName||"User"}),s.jsxs("div",{className:"text-xs text-muted-foreground",children:["@",e.user?.username]})]})]},e.id))}):s.jsx("div",{className:"text-center py-4",children:s.jsx("p",{className:"text-muted-foreground",children:"No one has RSVP'd as maybe yet"})})})]})})]})]})]}),s.jsx(C,{open:ue,onOpenChange:je,children:s.jsxs(k,{children:[s.jsxs(S,{children:[s.jsx($,{children:"Are you sure?"}),s.jsx(F,{children:"This action cannot be undone. This will permanently delete the event and remove all RSVPs."})]}),s.jsxs(P,{children:[s.jsx(R,{children:"Cancel"}),s.jsx(z,{onClick:()=>Pe.mutate(),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),s.jsx(_,{open:ve,onOpenChange:pe,children:s.jsxs(Q,{className:"sm:max-w-md",children:[s.jsxs(B,{children:[s.jsx(Y,{children:"Share This Event"}),s.jsx(G,{children:"Share this event with your friends and community"})]}),s.jsxs("div",{className:"flex flex-col space-y-4 py-4",children:[s.jsxs("div",{className:"flex justify-center space-x-4",children:[s.jsx(T,{url:ye,children:s.jsx(V,{size:48,round:!0})}),s.jsx(q,{url:ye,title:`Join me at ${we?.title||"this event"}!`,hashtags:["TheConnection","ChristianEvents"],children:s.jsx(L,{size:48,round:!0})}),s.jsx(A,{url:ye,title:`Join me at ${we?.title||"this event"}!`,children:s.jsx(K,{size:48,round:!0})}),s.jsx(U,{url:ye,title:`${we?.title||"Christian Event"}`,summary:`Join me at this event on The Connection platform: ${we?.title||"Christian Event"}`,children:s.jsx(D,{size:48,round:!0})}),s.jsx(I,{url:ye,subject:`Invitation: ${we?.title||"Event"}`,body:`I'd like to invite you to ${we?.title||"this event"}. Check it out here:`,children:s.jsx(M,{size:48,round:!0})})]}),s.jsxs("div",{className:"flex items-center justify-between space-x-2 bg-muted p-2 rounded-md",children:[s.jsx("div",{className:"truncate text-sm text-muted-foreground",children:ye}),s.jsx(d,{variant:"secondary",size:"sm",onClick:async()=>{try{await navigator.clipboard.writeText(ye),xe({title:"Link Copied",description:"Event link copied to clipboard"})}catch(e){xe({title:"Copy Failed",description:"Could not copy link to clipboard",variant:"destructive"})}},children:"Copy Link"})]}),s.jsx("div",{className:"text-center text-sm text-muted-foreground mt-2",children:"Event details will be shared when using these links"})]}),s.jsx(O,{asChild:!0,children:s.jsx(d,{variant:"outline",className:"mt-2",children:"Close"})})]})})]})}export{ce as default};
