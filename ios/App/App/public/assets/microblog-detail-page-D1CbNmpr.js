import{j as e}from"./vendor-radix-Cb0-vzxO.js";import{u as s}from"./vendor-query-qkAKzVJ0.js";import{v as t,u as i,g as a,B as r}from"./index-CQmKbNyS.js";import{M as o,a as n,c,b as d}from"./mobile-microblog-composer-By2QuW2B.js";import{q as l,A as m}from"./vendor-icons-CM8Yk8yJ.js";import"./vendor-react-eVk5PToZ.js";import"./vendor-utils-nlnd1Dju.js";import"./share-buttons-C-FR_qFy.js";import"./index-Dajqlzwd.js";import"./index-BTJIN2si.js";import"./textarea-BQP-18ak.js";function p(){const{id:p}=t(),{user:h,isLoading:x}=i(),u=parseInt(p),j=a("(max-width: 768px)"),{data:f,isLoading:y}=s({queryKey:["/api/microblogs",u],queryFn:async()=>{const e=await fetch(`/api/microblogs/${u}`);if(!e.ok)throw new Error("Failed to fetch microblog post");const s=await e.json();let t=null;try{const e=await fetch(`/api/users/${s.authorId}`);e.ok&&(t=await e.json())}catch(a){}let i=!1;if(h)try{const e=await fetch(`/api/users/${h.id}/liked-microblogs`);if(e.ok){i=(await e.json()).includes(s.id)}}catch(a){}return{...s,author:t,isLiked:i}},enabled:!isNaN(u)}),{data:w,isLoading:b}=s({queryKey:["/api/microblogs",u,"replies"],queryFn:async()=>{const e=await fetch(`/api/microblogs/${u}/replies`);if(!e.ok)throw new Error("Failed to fetch replies");const s=await e.json(),t=await Promise.all(s.map(async e=>{try{const s=await fetch(`/api/users/${e.authorId}`);return s.ok?await s.json():null}catch(s){return null}}));let i=[];if(h)try{const e=await fetch(`/api/users/${h.id}/liked-microblogs`);e.ok&&(i=await e.json())}catch(a){}return s.map((e,s)=>({...e,author:t[s],isLiked:i.includes(e.id)}))},enabled:!isNaN(u)}),v=y||b,N=!!h&&!x;return j?e.jsx(e.Fragment,{children:v?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(l,{className:"h-8 w-8 animate-spin text-primary"})}):f?e.jsxs("div",{children:[e.jsx(o,{post:f,isAuthenticated:N,isDetailView:!0}),e.jsxs("div",{className:"border-t border-secondary/10 mt-2 pt-3",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 px-3",children:"Replies"}),e.jsx(n,{parentId:f.id,minimized:!1,onSuccess:()=>{window.location.reload()}}),w&&w.length>0?e.jsx("div",{children:w.map(s=>e.jsx(o,{post:s,isAuthenticated:N},s.id))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No replies yet. Be the first to reply!"})]})]}):e.jsx("div",{className:"text-center py-10 text-muted-foreground",children:"Post not found or has been removed."})}):e.jsxs("div",{className:"container max-w-3xl py-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(r,{variant:"ghost",size:"sm",className:"gap-1",onClick:()=>window.history.back(),children:[e.jsx(m,{className:"h-4 w-4"})," Back"]})}),v?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(l,{className:"h-10 w-10 animate-spin text-primary"})}):f?e.jsxs("div",{children:[e.jsx(c,{post:f,isAuthenticated:N,isDetailView:!0}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Replies"}),e.jsx(d,{parentId:f.id,onSuccess:()=>{window.location.reload()}}),w&&w.length>0?e.jsx("div",{className:"mt-6",children:w.map(s=>e.jsx(c,{post:s,isAuthenticated:N},s.id))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No replies yet. Be the first to reply!"})]})]}):e.jsx("div",{className:"text-center py-10 text-muted-foreground",children:"Post not found or has been removed."})]})}export{p as default};
