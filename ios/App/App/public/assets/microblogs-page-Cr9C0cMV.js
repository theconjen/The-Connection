import{r as e,j as s}from"./vendor-radix-Cb0-vzxO.js";import{u as t}from"./vendor-query-qkAKzVJ0.js";import{g as a,B as i,m as r,u as l,S as n,w as o,x as c}from"./index-CQmKbNyS.js";import{T as d,a as m,b as x,c as h}from"./tabs-N8_zO4xm.js";import{M as u,a as p,b as j,c as f}from"./mobile-microblog-composer-By2QuW2B.js";import{q as v,m as N}from"./vendor-icons-CM8Yk8yJ.js";import{R as b}from"./RecommendedForYou-BCloEEst.js";import"./vendor-react-eVk5PToZ.js";import"./vendor-utils-nlnd1Dju.js";import"./share-buttons-C-FR_qFy.js";import"./index-Dajqlzwd.js";import"./index-BTJIN2si.js";import"./textarea-BQP-18ak.js";function y({onRefresh:t,children:i}){const r=a("(max-width: 768px)"),[l,n]=e.useState(!1),[o,c]=e.useState(0),[d,m]=e.useState(0);if(!r)return s.jsx(s.Fragment,{children:i});const x=Math.min(.4*d,100),h=Math.min(x/70,1);return s.jsxs("div",{className:"mobile-pull-refresh-container",onTouchStart:e=>{c(e.touches[0].clientY),m(0)},onTouchMove:e=>{const s=e.touches[0].clientY-o;s>0&&m(s)},onTouchEnd:()=>{d>70&&!l&&(n(!0),t().finally(()=>{n(!1),m(0)})),m(0)},style:{overflowY:"visible"},children:[d>0&&s.jsx("div",{className:"flex items-center justify-center transition-transform",style:{height:`${x}px`,opacity:h,transform:`translateY(${d>70?5:0}px)`},children:d>70?s.jsx("div",{className:"flex items-center",children:s.jsx("span",{className:"text-sm text-muted-foreground",children:"Release to refresh"})}):s.jsx("div",{className:"flex items-center",children:s.jsx("span",{className:"text-sm text-muted-foreground",children:"Pull down to refresh"})})}),l&&s.jsxs("div",{className:"flex items-center justify-center h-12 bg-background",children:[s.jsx(v,{className:"h-5 w-5 animate-spin mr-2 text-primary"}),s.jsx("span",{className:"text-sm",children:"Refreshing..."})]}),s.jsx("div",{className:l?"opacity-75":"",children:i})]})}function g({onClick:e,icon:t,label:a,position:l="bottom-right",className:n}){return s.jsxs(i,{onClick:e,className:r("fixed z-50 shadow-lg active-scale touch-target","h-14 w-14 rounded-full","bg-primary hover:bg-primary/90","flex items-center justify-center",{"bottom-right":"bottom-20 right-4","bottom-center":"bottom-20 left-1/2 transform -translate-x-1/2"}[l],n),"aria-label":a||"Action button",children:[t,a&&s.jsx("span",{className:"sr-only",children:a})]})}function w(){const{user:r,isLoading:w}=l(),[C,k]=e.useState("latest"),[S,R]=e.useState(!1),[L,F]=e.useState(!1),q=a("(max-width: 768px)"),z=e.useRef(null),{data:T,isLoading:Y,refetch:$}=t({queryKey:["/api/microblogs","latest"===C?"recent":"popular"],queryFn:async({queryKey:e})=>{const[s,t]=e,a=await fetch(`/api/microblogs?filter=${t}`);if(!a.ok)throw new Error("Failed to fetch microblogs");const i=await a.json(),l=await Promise.all(i.map(async e=>{try{const s=await fetch(`/api/users/${e.authorId}`);return s.ok?await s.json():null}catch(s){return null}}));let n=[];if(r)try{const e=await fetch(`/api/users/${r.id}/liked-microblogs`);e.ok&&(n=await e.json())}catch(o){}return i.map((e,s)=>({...e,author:l[s],isLiked:n.includes(e.id)}))},enabled:!w}),A=async()=>{R(!0),await $(),R(!1)},B=!!r;return q?s.jsxs(s.Fragment,{children:[r&&s.jsx("div",{className:"p-4",children:s.jsx(b,{section:"feed",maxItems:3,showHeader:!0})}),s.jsxs(d,{defaultValue:"latest",className:"w-full",onValueChange:k,children:[s.jsx("div",{className:"sticky top-[57px] mobile-nav-modern z-10 p-2",children:s.jsxs(m,{className:"grid w-full grid-cols-2 p-1 mb-0 mobile-modern-card",children:[s.jsx(x,{value:"latest",className:"text-sm mobile-text-modern data-[state=active]:bg-primary data-[state=active]:text-white",children:"Latest"}),s.jsx(x,{value:"popular",className:"text-sm mobile-text-modern data-[state=active]:bg-primary data-[state=active]:text-white",children:"Popular"})]})}),s.jsx(h,{value:"latest",className:"pt-2 m-0",children:s.jsx(y,{onRefresh:A,children:Y?s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(v,{className:"h-8 w-8 animate-spin text-primary"})}):T&&T.length>0?s.jsxs("div",{children:[T.map(e=>s.jsx(u,{post:e,isAuthenticated:B},e.id)),s.jsx("div",{className:"py-8 flex justify-center",children:s.jsx(i,{variant:"outline",size:"sm",className:"text-sm active-scale touch-target",onClick:A,children:"Load more"})})]}):s.jsx("div",{className:"text-center py-10 text-muted-foreground",children:"No posts found. Be the first to post!"})})}),s.jsx(h,{value:"popular",className:"pt-2 m-0",children:s.jsx(y,{onRefresh:A,children:Y?s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(v,{className:"h-8 w-8 animate-spin text-primary"})}):T&&T.length>0?s.jsxs("div",{children:[T.map(e=>s.jsx(u,{post:e,isAuthenticated:B},e.id)),s.jsx("div",{className:"py-8 flex justify-center",children:s.jsx(i,{variant:"outline",size:"sm",className:"text-sm active-scale touch-target",onClick:A,children:"Load more"})})]}):s.jsx("div",{className:"text-center py-10 text-muted-foreground",children:"No posts found. Be the first to post!"})})})]}),s.jsx(g,{onClick:()=>F(!0),icon:s.jsx(N,{className:"h-6 w-6 text-white"}),label:"Create post",position:"bottom-right"}),s.jsxs(n,{open:L,onOpenChange:F,children:[s.jsx(o,{asChild:!0,children:s.jsx("button",{ref:z,className:"hidden",children:"Open composer"})}),s.jsx(c,{side:"bottom",className:"h-[85vh] rounded-t-xl p-0",children:s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:"border-b p-3 flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-semibold",children:"Create post"}),s.jsx(i,{variant:"ghost",size:"sm",className:"h-8 px-2",onClick:()=>F(!1),children:"Cancel"})]}),s.jsx("div",{className:"flex-1 overflow-auto p-3",children:s.jsx(p,{onSuccess:()=>F(!1)})})]})})]})]}):s.jsxs("div",{className:"container max-w-3xl py-6",children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Feed"}),r&&s.jsx("div",{className:"mb-6",children:s.jsx(b,{section:"feed",maxItems:4,showHeader:!0})}),s.jsx(j,{}),s.jsx(d,{defaultValue:"latest",className:"mb-6",onValueChange:k,children:s.jsxs(m,{className:"grid w-full grid-cols-2",children:[s.jsx(x,{value:"latest",children:"Latest"}),s.jsx(x,{value:"popular",children:"Popular"})]})}),Y?s.jsx("div",{className:"flex justify-center py-10",children:s.jsx(v,{className:"h-10 w-10 animate-spin text-primary"})}):T&&T.length>0?s.jsx("div",{children:T.map(e=>s.jsx(f,{post:e,isAuthenticated:B},e.id))}):s.jsx("div",{className:"text-center py-10 text-muted-foreground",children:"No posts found. Be the first to post!"})]})}export{w as default};
