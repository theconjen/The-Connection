import{r as e,j as s}from"./vendor-radix-Cb0-vzxO.js";import{u as t,a}from"./vendor-query-qkAKzVJ0.js";import{H as r,u as n,h as i,C as l,a as o,B as c,b as m,f as d,A as h,e as x,k as u,q as j,i as p}from"./index-CQmKbNyS.js";import{M as v}from"./main-layout-BqoyFj5l.js";import{a as N}from"./schema-BhHnCEQU.js";import{T as f}from"./textarea-BQP-18ak.js";import{S as y}from"./skeleton-D3l7g_Rg.js";import{S as w}from"./share-buttons-C-FR_qFy.js";import{aC as b,j as g,o as k,p as C,aI as M,q as A}from"./vendor-icons-CM8Yk8yJ.js";import{f as P}from"./vendor-utils-nlnd1Dju.js";import{s as S}from"./types-DUVubNlp.js";import"./vendor-react-eVk5PToZ.js";import"./index-Dajqlzwd.js";import"./index-BTJIN2si.js";function L(){const[,N]=r("/posts/:id"),S=N,L=parseInt(S?.id||"0"),{user:$}=n(),{toast:q}=i(),[B,E]=e.useState(""),[T,z]=e.useState(!1),{data:H,isLoading:K}=t({queryKey:[`/api/posts/${L}`],enabled:L>0}),{data:R,isLoading:Z}=t({queryKey:[`/api/posts/${L}/comments`],enabled:L>0}),D=a({mutationFn:async()=>{const e=await p("POST",`/api/posts/${L}/upvote`);return await e.json()},onSuccess:e=>{j.invalidateQueries({queryKey:[`/api/posts/${L}`]})},onError:e=>{q({title:"Error",description:"Could not upvote the post. Please try again.",variant:"destructive"})}}),F=a({mutationFn:async e=>{const s={content:e,postId:L,authorId:$.id},t=await p("POST","/api/comments",s);return await t.json()},onSuccess:()=>{E(""),j.invalidateQueries({queryKey:[`/api/posts/${L}/comments`]}),j.invalidateQueries({queryKey:[`/api/posts/${L}`]}),q({title:"Comment Added",description:"Your comment has been posted successfully."})},onError:e=>{q({title:"Error",description:"Could not add your comment. Please try again.",variant:"destructive"})}}),Q=a({mutationFn:async e=>{const s=await p("POST",`/api/comments/${e}/upvote`);return await s.json()},onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/posts/${L}/comments`]})},onError:e=>{q({title:"Error",description:"Could not upvote the comment. Please try again.",variant:"destructive"})}}),W=e=>{const s=new Date,t=Math.floor((s.getTime()-e.getTime())/1e3);return t<60?`${t} seconds ago`:t<3600?`${Math.floor(t/60)} minutes ago`:t<86400?`${Math.floor(t/3600)} hours ago`:t<2592e3?`${Math.floor(t/86400)} days ago`:P(e,"MMM d, yyyy")},I=(e="")=>e.substring(0,2).toUpperCase();return s.jsxs(v,{children:[s.jsxs("div",{className:"flex-1",children:[K?s.jsx(l,{className:"mb-6",children:s.jsxs(o,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx(y,{className:"w-10 h-10 rounded-full mr-3"}),s.jsxs("div",{children:[s.jsx(y,{className:"h-4 w-24"}),s.jsx(y,{className:"h-3 w-40 mt-1"})]})]}),s.jsx(y,{className:"h-8 w-3/4 mb-4"}),s.jsx(y,{className:"h-4 w-full mb-1"}),s.jsx(y,{className:"h-4 w-full mb-1"}),s.jsx(y,{className:"h-4 w-full mb-1"}),s.jsx(y,{className:"h-4 w-full mb-1"}),s.jsx(y,{className:"h-4 w-2/3 mb-6"}),s.jsxs("div",{className:"flex space-x-4",children:[s.jsx(y,{className:"h-8 w-16"}),s.jsx(y,{className:"h-8 w-24"}),s.jsx(y,{className:"h-8 w-16"})]})]})}):H?s.jsxs(l,{className:"mb-6 overflow-hidden",children:[H.imageUrl&&s.jsx("div",{className:"w-full h-64 sm:h-80 md:h-96 overflow-hidden",children:s.jsx("img",{src:H.imageUrl,alt:H.title,className:"w-full h-full object-cover"})}),s.jsxs(o,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[H.community&&((e,t)=>{let a,r="";switch(t){case"primary":r="bg-primary-100 text-primary-600";break;case"secondary":r="bg-green-100 text-green-600";break;case"accent":r="bg-amber-100 text-amber-600";break;case"red":r="bg-red-100 text-red-500";break;default:r="bg-neutral-100 text-neutral-600"}switch(e){case"pray":a=s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-5 w-5",children:[s.jsx("path",{d:"M12 2v1"}),s.jsx("path",{d:"M12 21v-1"}),s.jsx("path",{d:"M3.3 7.8c-.4-1 .1-2 1-2.4 1-.4 2 .1 2.4 1 .4 1-.1 2-1 2.4-1 .4-2-.1-2.4-1Z"}),s.jsx("path",{d:"M20.7 16.2c-.4-1 .1-2 1-2.4 1-.4 2 .1 2.4 1 .4 1-.1 2-1 2.4-1 .4-2-.1-2.4-1Z"}),s.jsx("path",{d:"M3.3 16.2c-.4-1 .1-2 1-2.4 1-.4 2 .1 2.4 1 .4 1-.1 2-1 2.4-1 .4-2-.1-2.4-1Z"}),s.jsx("path",{d:"M20.7 7.8c-.4-1 .1-2 1-2.4 1-.4 2 .1 2.4 1 .4 1-.1 2-1 2.4-1 .4-2-.1-2.4-1Z"}),s.jsx("path",{d:"M9 15.9a4 4 0 0 0 6 0"}),s.jsx("path",{d:"M17 10c.7-.7.7-1.3 0-2"}),s.jsx("path",{d:"M7 8c-.7.7-.7 1.3 0 2"})]});break;case"book":a=s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-5 w-5",children:s.jsx("path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"})});break;case"church":a=s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-5 w-5",children:[s.jsx("path",{d:"m2 22 10-10 10 10"}),s.jsx("path",{d:"M4 15v7"}),s.jsx("path",{d:"M20 15v7"}),s.jsx("path",{d:"M12 9v3"}),s.jsx("path",{d:"M12 3a6 6 0 0 1 1 3.142c0 .64-.057 1.11-.172 1.415-.114.306-.242.483-.242.483L12 9l-.586-.96s-.128-.177-.242-.483C11.057 7.252 11 6.782 11 6.142A6 6 0 0 1 12 3Z"})]});break;case"heart":a=s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-5 w-5",children:s.jsx("path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"})});break;default:a=s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-5 w-5",children:[s.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),s.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}return s.jsx("div",{className:`w-10 h-10 rounded-full ${r} flex items-center justify-center mr-3`,children:a})})(H.community.iconName,H.community.iconColor),s.jsxs("div",{children:[s.jsxs("a",{href:`/community/${H.community?.slug}`,className:"font-medium hover:text-primary",children:["r/",H.community?.slug]}),s.jsxs("div",{className:"text-xs text-neutral-500",children:["Posted by"," ",s.jsxs("a",{href:`/user/${H.author?.username||"anonymous"}`,className:"hover:underline",children:["u/",H.author?.username||"anonymous"]})," â€¢ ",H.createdAt?W(new Date(H.createdAt)):"recently"]})]})]}),s.jsx("h1",{className:"text-2xl font-bold mb-4",children:H.title}),s.jsxs("div",{className:"text-neutral-700 mb-6 whitespace-pre-line",children:[H.content,H.content.includes("John 3:16")&&s.jsx("blockquote",{className:"scripture border-l-4 border-accent-500 pl-4 py-2 my-4 italic text-neutral-700 bg-neutral-50",children:'"For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life." - John 3:16'})]}),s.jsxs("div",{className:"flex items-center space-x-4 text-sm border-t pt-4 border-neutral-200",children:[s.jsxs(c,{variant:"ghost",size:"sm",className:"flex items-center text-neutral-500 hover:text-primary",onClick:()=>{$?D.mutate():q({title:"Authentication Required",description:"Please log in to upvote posts.",variant:"default"})},children:[s.jsx(b,{className:"mr-1 h-4 w-4"}),s.jsx("span",{children:H.upvotes})]}),s.jsxs(c,{variant:"ghost",size:"sm",className:"flex items-center text-neutral-500 hover:text-primary",children:[s.jsx(g,{className:"mr-1 h-4 w-4"}),s.jsxs("span",{children:[H.commentCount," comments"]})]}),s.jsxs(c,{variant:"ghost",size:"sm",className:"flex items-center text-neutral-500 hover:text-primary",onClick:()=>z(!T),children:[s.jsx(k,{className:"mr-1 h-4 w-4"}),s.jsx("span",{children:"Share"})]}),s.jsxs(c,{variant:"ghost",size:"sm",className:"flex items-center text-neutral-500 hover:text-primary",children:[s.jsx(C,{className:"mr-1 h-4 w-4"}),s.jsx("span",{children:"Save"})]}),s.jsxs(c,{variant:"ghost",size:"sm",className:"flex items-center text-neutral-500 hover:text-primary ml-auto",onClick:()=>{navigator.clipboard.writeText(window.location.href),q({title:"Link Copied",description:"Post link copied to clipboard."})},children:[s.jsx(M,{className:"mr-1 h-4 w-4"}),s.jsx("span",{children:"Copy Link"})]})]}),T&&s.jsxs("div",{className:"mt-4 p-4 border rounded-lg",children:[s.jsx("h3",{className:"text-sm font-medium mb-3",children:"Share this post:"}),s.jsx(w,{url:`/posts/${H.id}`,title:H.title})]})]})]}):s.jsx(l,{className:"mb-6 p-8 text-center",children:s.jsxs(o,{children:[s.jsx("h1",{className:"text-xl font-medium mb-2",children:"Post not found"}),s.jsx("p",{className:"text-neutral-600",children:"The post you're looking for doesn't exist or has been removed."})]})}),H&&s.jsxs(l,{className:"mb-6",children:[s.jsx(m,{children:s.jsx(d,{children:"Add a Comment"})}),s.jsx(o,{children:s.jsxs("form",{onSubmit:e=>{e.preventDefault(),$?B.trim()?F.mutate(B):q({title:"Empty Comment",description:"Please enter a comment before submitting.",variant:"destructive"}):q({title:"Authentication Required",description:"Please log in to add comments.",variant:"default"})},children:[s.jsx(f,{placeholder:$?"Share your thoughts...":"Please sign in to comment",value:B,onChange:e=>E(e.target.value),className:"mb-4",disabled:!$||F.isPending}),s.jsx("div",{className:"flex justify-end",children:s.jsx(c,{type:"submit",disabled:!$||!B.trim()||F.isPending,children:F.isPending?s.jsxs(s.Fragment,{children:[s.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}),"Posting..."]}):"Post Comment"})})]})})]}),s.jsxs(l,{children:[s.jsx(m,{children:s.jsxs(d,{children:["Comments (",R?.length||0,")"]})}),s.jsx(o,{children:Z?s.jsx("div",{className:"space-y-6",children:Array.from({length:3}).map((e,t)=>s.jsxs("div",{className:"flex space-x-4",children:[s.jsx(y,{className:"w-10 h-10 rounded-full flex-shrink-0"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx(y,{className:"h-4 w-40"}),s.jsx(y,{className:"h-4 w-full"}),s.jsx(y,{className:"h-4 w-full"}),s.jsx(y,{className:"h-4 w-2/3"})]})]},t))}):R&&R.length>0?s.jsx("div",{className:"space-y-6",children:R.map(e=>s.jsxs("div",{className:"flex space-x-4",children:[s.jsx(h,{className:"w-10 h-10 flex-shrink-0",children:s.jsx(x,{className:"bg-neutral-200 text-neutral-700",children:I(e.author?.username)})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx("span",{className:"font-medium text-sm",children:e.author?.username||"Anonymous"}),s.jsx("span",{className:"text-xs text-neutral-500 ml-2",children:e.createdAt?W(new Date(e.createdAt)):"recently"})]}),s.jsx("p",{className:"text-neutral-700 mb-2",children:e.content}),s.jsxs("div",{className:"flex items-center space-x-4 text-xs",children:[s.jsxs(c,{variant:"ghost",size:"sm",className:"h-6 px-2 text-neutral-500 hover:text-primary",onClick:()=>{return s=e.id,void($?Q.mutate(s):q({title:"Authentication Required",description:"Please log in to upvote comments.",variant:"default"}));var s},children:[s.jsx(b,{className:"mr-1 h-3 w-3"}),s.jsx("span",{children:e.upvotes})]}),s.jsxs(c,{variant:"ghost",size:"sm",className:"h-6 px-2 text-neutral-500 hover:text-primary",children:[s.jsx(g,{className:"mr-1 h-3 w-3"}),s.jsx("span",{children:"Reply"})]})]})]})]},e.id))}):s.jsx("div",{className:"py-8 text-center",children:s.jsx("p",{className:"text-neutral-600",children:"No comments yet. Be the first to share your thoughts!"})})})]})]}),s.jsxs("aside",{className:"hidden lg:block w-80 space-y-6 sticky top-24 self-start",children:[H?.community&&s.jsxs(l,{children:[s.jsx(m,{className:"bg-neutral-50 border-b border-neutral-200",children:s.jsxs(d,{className:"text-neutral-800",children:["About r/",H.community.slug]})}),s.jsxs(o,{className:"p-4",children:[s.jsx("p",{className:"text-neutral-600 text-sm mb-4",children:H.community.description}),s.jsxs("div",{className:"flex items-center justify-between text-sm text-neutral-500",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-neutral-900",children:H.community.memberCount})," members"]}),s.jsx("div",{children:H.community.createdAt&&s.jsxs("span",{children:["Created ",P(new Date(H.community.createdAt),"MMM yyyy")]})})]})]}),s.jsx(u,{className:"border-t border-neutral-200 bg-neutral-50",children:s.jsx(c,{variant:"outline",className:"w-full",children:"Join Community"})})]}),s.jsxs(l,{children:[s.jsx(m,{className:"bg-neutral-50 border-b border-neutral-200",children:s.jsx(d,{className:"text-neutral-800",children:"Community Rules"})}),s.jsx(o,{className:"p-4",children:s.jsxs("ul",{className:"space-y-3 text-sm",children:[s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"font-medium mr-2",children:"1."}),s.jsx("span",{children:"Be respectful and kind to others."})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"font-medium mr-2",children:"2."}),s.jsx("span",{children:"No spam or self-promotion."})]}),s.jsxs("li",{className:"flex items-start",children:[s.jsx("span",{className:"font-medium mr-2",children:"3."}),s.jsx("span",{children:"Base discussions on Scripture when possible."})]})]})})]})]})]})}N.extend({content:S().min(1,"Comment cannot be empty")});export{L as default};
